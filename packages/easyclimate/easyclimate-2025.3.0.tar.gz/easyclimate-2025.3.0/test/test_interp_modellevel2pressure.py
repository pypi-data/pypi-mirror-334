"""
pytest for interp.modellevel2pressure.py
"""

import pytest

import easyclimate as ecl
import numpy as np
import xarray as xr

# u_test_data
u_test_data = xr.DataArray(
    np.array(
        [
            [-15.080393, -15.108263],
            [-10.749071, -10.797842],
            [-4.7920494, -4.501747],
            [-2.3813725, -2.5067825],
            [-1.4152431, -1.0901031],
            [-0.6465206, -0.6697445],
            [-7.8181705, -7.6648884],
            [-14.718096, -14.917826],
            [-14.65539, -14.736677],
            [-14.948015, -15.112909],
            [-13.705519, -13.772867],
            [-11.443476, -11.543341],
            [-8.865583, -8.798235],
            [-7.9528713, -7.9668064],
            [-8.329103, -8.570635],
            [-7.2445316, -7.349039],
            [-6.7150173, -6.7521763],
            [-5.5189686, -5.4400063],
            [-4.139448, -4.0697765],
            [-3.2731838, -3.2151241],
            [-2.2931194, -2.1491299],
            [-1.0041752, -0.84160423],
            [-1.8983078, -1.7496719],
            [-2.3674374, -2.2118359],
            [-2.8203106, -2.8319225],
            [-3.2940865, -3.3521461],
            [-3.526329, -3.5054264],
            [-3.8654022, -3.7910843],
            [-4.164995, -4.0674534],
            [-4.2834396, -4.1696396],
            [-4.2950516, -4.239313],
            [-4.3438225, -4.2950516],
            [-4.3716908, -4.2811165],
            [-4.7688255, -4.689863],
            [-4.6155453, -4.5296154],
            [-4.5528393, -4.464588],
            [-4.4831676, -4.3925934],
            [-4.385626, -4.2950516],
            [-4.2950516, -4.2067986],
            [-4.0953217, -4.011715],
        ]
    ),
    dims=("model_level", "lon"),
    coords={
        "model_level": np.array(
            [
                36,
                44,
                51,
                56,
                60,
                63,
                67,
                70,
                73,
                75,
                78,
                81,
                83,
                85,
                88,
                90,
                92,
                94,
                96,
                98,
                100,
                102,
                104,
                105,
                107,
                109,
                111,
                113,
                115,
                117,
                119,
                122,
                124,
                126,
                129,
                131,
                133,
                135,
                136,
                137,
            ]
        ),
        "lon": np.array([180.0, 180.2]),
    },
)

# p_test_data
p_test_data = xr.DataArray(
    np.array(
        [
            [2081.4756, 2081.4756],
            [3917.6995, 3917.6995],
            [6162.6455, 6162.6455],
            [8171.3506, 8171.3506],
            [10112.652, 10112.65],
            [11811.783, 11811.778],
            [14447.391, 14447.372],
            [16734.607, 16734.566],
            [19317.787, 19317.71],
            [21218.21, 21218.102],
            [24357.875, 24357.703],
            [27871.277, 27871.016],
            [30436.492, 30436.16],
            [33191.027, 33190.61],
            [37698.96, 37698.4],
            [40969.438, 40968.758],
            [44463.73, 44462.92],
            [48191.92, 48190.97],
            [52151.29, 52150.176],
            [56291.098, 56289.816],
            [60525.63, 60524.164],
            [64770.367, 64768.727],
            [68943.69, 68941.86],
            [70979.66, 70977.73],
            [74908.17, 74906.07],
            [78599.67, 78597.41],
            [82012.95, 82010.53],
            [85122.69, 85120.125],
            [87918.29, 87915.586],
            [90401.77, 90398.96],
            [92584.94, 92582.02],
            [95338.72, 95335.68],
            [96862.08, 96858.97],
            [98165.305, 98162.14],
            [99763.38, 99760.16],
            [100626.21, 100622.94],
            [101352.69, 101349.38],
            [101962.28, 101958.96],
            [102228.875, 102225.55],
            [102483.055, 102479.72],
        ]
    ),
    dims=("model_level", "lon"),
    coords={
        "model_level": np.array(
            [
                36,
                44,
                51,
                56,
                60,
                63,
                67,
                70,
                73,
                75,
                78,
                81,
                83,
                85,
                88,
                90,
                92,
                94,
                96,
                98,
                100,
                102,
                104,
                105,
                107,
                109,
                111,
                113,
                115,
                117,
                119,
                122,
                124,
                126,
                129,
                131,
                133,
                135,
                136,
                137,
            ]
        ),
        "lon": np.array([180.0, 180.2]),
    },
)


def test_interp1d_vertical_model2pressure():
    result_data = ecl.interp.interp1d_vertical_model2pressure(
        pressure_data=p_test_data,
        variable_data=u_test_data,
        vertical_input_dim="model_level",
        vertical_output_dim="plev",
        vertical_output_level=[50000, 85000],
    ).data.flatten()
    refer_data = np.array([-4.87545826, -3.85226099, -4.80047443, -3.78024438])
    assert np.isclose(result_data, refer_data).all()
