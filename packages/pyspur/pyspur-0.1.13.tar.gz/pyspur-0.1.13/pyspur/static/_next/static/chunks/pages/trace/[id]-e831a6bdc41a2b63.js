(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2679,3379],{32218:(e,t,o)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/trace/[id]",function(){return o(26982)}])},48850:(e,t,o)=>{"use strict";o.d(t,{A:()=>r});var n=o(74848);o(96540);let r=()=>(0,n.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"})})},26982:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>C});var n=o(74848),r=o(77528),i=o(55456),s=o(87947),l=o(53692),a=o(88781),d=o(96540),u=o(7651);o(69703);var c=o(71468),f=o(52136),p=o(29838),w=o(53212),h=o(95258),b=(o(33596),o(48850)),y=o(43346),_=o(80893),k=o(36240);let m=e=>{let{workflowData:t,workflowID:o,tasksData:m,onDownloadImageInit:g,projectName:v="workflow"}=e,x=(0,c.wA)(),j=(0,c.d4)(e=>e.nodeTypes.data),{nodeTypes:E,isLoading:O}=(0,h.Tj)({nodeTypesConfig:j,readOnly:!0,includeCoalesceNode:!1}),S=(0,d.useMemo)(()=>({custom:e=>(0,n.jsx)(_.A,(0,i._)((0,r._)({},e),{readOnly:!0}))}),[]);(0,d.useEffect)(()=>{if(t){if(t.definition.nodes){let e=t.definition.nodes.filter(e=>"InputNode"===e.node_type&&null===e.parent_id);if(e.length>0){let t=e[0].config.input_schema;t&&Object.entries(t).map(e=>{let[t,o]=e;return{key:t,value:""}}).forEach(e=>{x((0,p.U)(e))})}}x((0,p.R$)({nodeTypes:j,definition:t.definition,workflowID:o,name:t.name}))}},[x,t,o]),(0,d.useEffect)(()=>{m&&m.length>0&&m.forEach(e=>{let t=e.node_id;x((0,p.Kp)({id:t,data:{run:e.outputs||{},error:e.error||null,taskStatus:e.status}})),e.subworkflow_output&&Object.entries(e.subworkflow_output).forEach(e=>{let[t,o]=e;x((0,p.Kp)({id:t,data:{run:o,taskStatus:"COMPLETED"}}))})})},[x,m]);let C=(0,c.d4)(e=>e.flow.nodes),D=(0,c.d4)(e=>e.flow.edges),N=(0,c.d4)(e=>e.flow.selectedNode),[I,P]=(0,d.useState)(null),[A,L]=(0,d.useState)({horizontal:null,vertical:null}),[M,T]=(0,d.useState)(null),[V,K]=(0,d.useState)(null),Q=(0,w.y)(e=>e.mode),{getIntersectingNodes:z,getNodes:B,updateNode:W}=(0,s.VH)(),{onNodesChange:R,onEdgesChange:U,onConnect:F}=(0,h.dW)({dispatch:x,nodes:C,setHelperLines:L}),q=(0,h.Bf)({edges:D,hoveredNode:M,hoveredEdge:V,selectedEdgeId:null,readOnly:!0}),G=(0,h.ml)({nodes:C,mode:Q}),J=(0,h.Fu)({nodes:G}),Z=(0,d.useMemo)(()=>{let e={};return m&&m.length>0&&m.forEach(t=>{t.outputs?e[t.node_id]=t.outputs:"PAUSED"===t.status&&(e[t.node_id]={__paused:!0}),t.subworkflow_output&&Object.entries(t.subworkflow_output).forEach(t=>{let[o,n]=t;e[o]=n})}),e},[m]),$=(0,h.$O)({nodes:J,nodeOutputs:Z}),X=(0,d.useCallback)((e,t)=>{K(t.id)},[]),H=(0,d.useCallback)(()=>{K(null)},[]),Y=(0,d.useCallback)(e=>{P(e),e.setViewport({x:0,y:0,zoom:.8})},[]),ee=(0,d.useCallback)((e,t)=>{x((0,p.Qi)({nodeId:t.id}))},[x]),et=(0,d.useCallback)(()=>{N&&x((0,p.Qi)({nodeId:null}))},[x,N]),eo=(0,d.useCallback)(e=>{e.forEach(e=>{x((0,p.AC)({nodeId:e.id})),N===e.id&&x((0,p.Qi)({nodeId:null}))})},[x,N]),en=(0,d.useCallback)(()=>{let e=(0,u.B)(C,D);x((0,p.CU)({nodes:e}))},[C,D,x]),er=(0,d.useCallback)(e=>{let t=e.target,o=t.tagName.toLowerCase();if(t.isContentEditable||"input"===o||"textarea"===o||"select"===o)return;if("Delete"===e.key||"Backspace"===e.key){let e=C.filter(e=>e.selected);e.length>0&&eo(e)}let n=e.shiftKey?45:15;if(I){let{x:t,y:o,zoom:r}=I.getViewport();switch(e.key){case"ArrowLeft":I.setViewport({x:t+n,y:o,zoom:r});break;case"ArrowRight":I.setViewport({x:t-n,y:o,zoom:r});break;case"ArrowUp":I.setViewport({x:t,y:o+n,zoom:r});break;case"ArrowDown":I.setViewport({x:t,y:o-n,zoom:r})}}},[C,eo,I]);(0,d.useEffect)(()=>(window.addEventListener("keydown",er),()=>{window.removeEventListener("keydown",er)}),[er]),(0,f.K)(N,C,E,j,x,en);let ei=(0,d.useCallback)((e,t)=>{T(t.id)},[]),es=(0,d.useCallback)(()=>{T(null)},[]),el=(0,d.useCallback)(()=>{let e=B(),t=(0,l.Jo)(e),o=t.width||1,n=t.height||1,r=Math.min(1080/o,607.5/n),i=(0,l.R4)(t,1200,675,r,r,.05*Math.min(o,n));(0,a.$E)(document.querySelector(".react-flow__viewport"),{backgroundColor:"transparent",width:1200,height:675,style:{width:"".concat(1200,"px"),height:"".concat(675,"px"),transform:"translate(".concat(i.x,"px, ").concat(i.y,"px) scale(").concat(i.zoom,")")}}).then(e=>{let t=document.createElement("a");t.href=e,t.download="".concat(v,"_trace.png"),t.click()}).catch(e=>{console.error("Failed to download image",e)})},[B,v]);return((0,d.useEffect)(()=>{g&&g(el)},[el,g]),O)?(0,n.jsx)(b.A,{}):(0,n.jsx)("div",{style:{position:"relative",height:"100%"},children:(0,n.jsxs)("div",{style:{width:"100%",height:"100%",overflow:"hidden"},children:[(0,n.jsx)("div",{style:{height:"100%",overflow:"auto",position:"relative",zIndex:1},children:(0,n.jsxs)(s.Gc,{nodes:$,edges:q,onNodesChange:R,onEdgesChange:U,onConnect:F,nodeTypes:E,edgeTypes:S,fitView:!0,onInit:Y,onNodeClick:ee,onPaneClick:et,onNodesDelete:eo,proOptions:{hideAttribution:!0},panOnDrag:"hand"===Q&&!C.filter(Boolean).some(e=>e.selected),panOnScroll:!0,zoomOnScroll:!0,minZoom:.1,maxZoom:2,selectionMode:"pointer"===Q?l.Qc.Full:l.Qc.Partial,selectNodesOnDrag:"pointer"===Q,selectionOnDrag:"pointer"===Q,selectionKeyCode:"pointer"===Q?null:void 0,multiSelectionKeyCode:"pointer"===Q?null:void 0,deleteKeyCode:"Delete",nodesConnectable:!0,connectionMode:l.WZ.Loose,onNodeMouseEnter:ei,onNodeMouseLeave:es,onEdgeMouseEnter:X,onEdgeMouseLeave:H,snapToGrid:!1,children:[(0,n.jsx)(s.VS,{},"background"),!1,(0,n.jsx)(k.A,{handleLayout:en,handleDownloadImage:el},"operator")]},"flow-".concat(o))}),N&&(0,n.jsx)("div",{className:"absolute top-0 right-0 h-full bg-white border-l border-gray-200",style:{zIndex:2},children:(0,n.jsx)(y.A,{nodeID:N,readOnly:!0},"node-sidebar-".concat(N))})]})})},g=e=>{let{workflowData:t,workflowID:o,tasksData:r,onDownloadImageInit:i,projectName:l}=e;return(0,n.jsx)(s.Ln,{children:(0,n.jsx)(m,{workflowData:t,workflowID:o,tasksData:r,onDownloadImageInit:i,projectName:l},"flow-content-".concat(o))})};var v=o(86715),x=o(68131),j=o(8640),E=o(48379),O=o(73232),S=o(81924);let C=()=>{let e=(0,c.wA)(),{id:t}=(0,v.useRouter)().query,[o,s]=(0,d.useState)(null),[l,a]=(0,d.useState)(null),[u,f]=(0,d.useState)(null),[w,h]=(0,d.useState)(),[y,_]=(0,d.useState)([]),k=(0,c.d4)(e=>e.flow.projectName);return((0,d.useEffect)(()=>{e((0,E.WK)());let o=async()=>{try{var o;if("string"!=typeof t)return;let n=await (0,S.Wb)(t);if(a(n.workflow_id),s(n),null===(o=n.workflow_version)||void 0===o?void 0:o.definition){e((0,p.iD)(n.workflow_version.definition.test_inputs));let{rolledOutDefinition:t}=n.tasks?function(e){let{workflowDefinition:t,tasks:o}=e,n=JSON.parse(JSON.stringify(t)),s={};return o.forEach(e=>{if(e.outputs&&(s[e.node_id]=e.outputs),!e.subworkflow)return;if("ForLoopNode"===n.nodes.find(t=>t.id===e.node_id).node_type){e.subworkflow_output&&(s=(0,r._)({},s,e.subworkflow_output));return}let t=n.nodes.find(t=>t.id===e.node_id);if(!t)return;let o=e.subworkflow,l="".concat(e.node_id,"_");e.subworkflow_output&&Object.entries(e.subworkflow_output).forEach(e=>{let[t,o]=e;s[l+t]=o});let a=o.nodes.map(e=>(0,i._)((0,r._)({},e),{id:l+e.id,coordinates:{x:t.coordinates.x,y:t.coordinates.y}})),d=a.find(e=>"InputNode"===e.node_type),u=a.find(e=>"OutputNode"===e.node_type);if(!d||!u){console.error("Subworkflow missing input or output node");return}n.links.forEach(e=>{e.target_id===t.id&&(e.target_id=d.id),e.source_id===t.id&&(e.source_id=u.id)}),n.nodes=n.nodes.filter(e=>e.id!==t.id),n.nodes.push(...a),n.links=n.links.concat(o.links.map(e=>(0,i._)((0,r._)({},e),{source_id:l+e.source_id,target_id:l+e.target_id})))}),{rolledOutDefinition:n,outputs:s}}({workflowDefinition:n.workflow_version.definition,tasks:n.tasks}):{rolledOutDefinition:n.workflow_version.definition};f({name:n.workflow_version.name,definition:t}),n.tasks&&_(n.tasks)}}catch(e){console.error("Error fetching run:",e)}};t&&o()},[t,e]),u)?(0,n.jsx)(x.Q,{loading:null,persistor:O.q,children:(0,n.jsxs)("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[(0,n.jsx)(j.A,{activePage:"trace",associatedWorkflowId:l,runId:t,handleDownloadImage:w}),(0,n.jsx)("div",{style:{flexGrow:1},children:(0,n.jsx)(g,{workflowData:u,workflowID:l,tasksData:y,onDownloadImageInit:e=>h(()=>e),projectName:k})})]})}):(0,n.jsx)(b.A,{})}},68131:(e,t,o)=>{"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o.d(t,{Q:()=>a});var a=function(e){var t;function o(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o);for(var e,t,s,a=arguments.length,d=Array(a),u=0;u<a;u++)d[u]=arguments[u];return s=(e=(t=r(o)).call.apply(t,[this].concat(d)))&&("object"===n(e)||"function"==typeof e)?e:i(this),l(i(s),"state",{bootstrapped:!1}),l(i(s),"_unsubscribe",void 0),l(i(s),"handlePersistorState",function(){s.props.persistor.getState().bootstrapped&&(s.props.onBeforeLift?Promise.resolve(s.props.onBeforeLift()).finally(function(){return s.setState({bootstrapped:!0})}):s.setState({bootstrapped:!0}),s._unsubscribe&&s._unsubscribe())}),s}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(o,e),t=[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return"function"==typeof this.props.children?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}],function(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(o.prototype,t),o}(o(96540).PureComponent);l(a,"defaultProps",{children:null,loading:null})}},e=>{var t=t=>e(e.s=t);e.O(0,[7998,8872,1570,7809,8660,4486,7354,453,3427,2327,7973,8667,6743,5610,3163,8640,7064,232,636,6593,8792],()=>t(32218)),_N_E=e.O()}]);