(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[923],{7350:(e,t,n)=>{var l=n(38221),o=n(23805);e.exports=function(e,t,n){var a=!0,r=!0;if("function"!=typeof e)throw TypeError("Expected a function");return o(n)&&(a="leading"in n?!!n.leading:a,r="trailing"in n?!!n.trailing:r),l(e,t,{leading:a,maxWait:t,trailing:r})}},90923:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>B});var l=n(74848),o=n(7651),a=n(50227),r=n(45388),s=n(73486),i=n(69554),d=n(37399),c=n(87947),u=n(53692);n(69703);var g=n(88781),m=n(7350),h=n.n(m),x=n(2404),f=n.n(x),p=n(96540),v=n(71468),w=n(52136),y=n(5266),b=n(29838),k=n(53212),j=n(84994),C=n(95258),N=n(77528),E=n(55456);let S=function(){let e=(0,v.d4)(e=>e.flow.nodes),t=(0,v.d4)(e=>e.flow.edges),n=(0,p.useRef)(null),l=(0,v.wA)(),[o,a]=(0,p.useState)([]),[r,s]=(0,p.useState)([]),i=(0,p.useCallback)(()=>{let n=e.filter(e=>e.selected),l=(0,u.AX)(n,t).filter(e=>{let t=n.every(t=>t.id!==e.source),l=n.every(t=>t.id!==e.target);return!(t||l)});a(n),s(l)},[e,t]),d=(0,p.useCallback)(()=>{let n=e.filter(e=>e.selected),o=(0,u.AX)(n,t).filter(e=>{let t=n.every(t=>t.id!==e.source),l=n.every(t=>t.id!==e.target);return!(t||l)});a(n),s(o);let r=e.filter(e=>!e.selected),i=t.filter(e=>!o.includes(e));l((0,b.CU)({nodes:r})),l((0,b.jY)({edges:i}))},[e,t,l]),c=(0,p.useCallback)(()=>{if(0===o.length||n.current)return;n.current=setTimeout(()=>{n.current=null},300);let a={x:window.innerWidth/2,y:window.innerHeight/2},s=Math.min(...o.map(e=>e.position.x)),i=Math.min(...o.map(e=>e.position.y)),d=Date.now(),c=o.map(e=>{let t="".concat(e.id,"-").concat(d),n=a.x/2+(e.position.x-s),l=a.y/2+(e.position.y-i);return(0,E._)((0,N._)({},e),{id:t,position:{x:n,y:l}})}),u=r.map(e=>{let t="".concat(e.id,"-").concat(d),n="".concat(e.source,"-").concat(d),l="".concat(e.target,"-").concat(d);return(0,E._)((0,N._)({},e),{id:t,source:n,target:l})}),g=[...e.map(e=>(0,E._)((0,N._)({},e),{selected:!1})),...c],m=[...t.map(e=>(0,E._)((0,N._)({},e),{selected:!1})),...u];l((0,b.CU)({nodes:g})),l((0,b.jY)({edges:m}))},[o,r,e,t,l]),g=(0,p.useCallback)(e=>{var t;(null===(t=e.target)||void 0===t?void 0:t.closest(".react-flow"))&&((e.metaKey||e.ctrlKey)&&"c"===e.key?i():(e.metaKey||e.ctrlKey)&&"v"===e.key?c():(e.metaKey||e.ctrlKey)&&"x"===e.key&&d())},[i,c,d]);return(0,p.useEffect)(()=>(window.addEventListener("keydown",g),()=>{window.removeEventListener("keydown",g)}),[g]),(0,p.useEffect)(()=>()=>{n.current&&clearTimeout(n.current)},[]),{cut:d,copy:i,paste:c,bufferedNodes:o,bufferedEdges:r}};n(33596);var I=n(48850),A=n(31024),O=n(72748),_=n(49517),D=n(97151),L=n(65468),K=n(66933);let T=()=>{let e=(0,v.d4)(e=>e.panel.isNodePanelExpanded),t=(0,v.wA)(),n=(0,v.d4)(e=>e.flow.nodes),o=(0,v.d4)(e=>e.nodeTypes.data),a=(0,c.VH)(),[r,s]=(0,p.useState)(""),[i,u]=(0,p.useState)(new Set),[g,m]=(0,p.useState)({}),h=(0,p.useRef)(null),x=(0,p.useRef)(null),[f,w]=(0,p.useState)(-1);(0,K.vC)("mod+k",n=>{if(n.preventDefault(),e&&document.activeElement===h.current){var l;null===(l=h.current)||void 0===l||l.blur()}t((0,j.iv)(!e))},{enableOnFormTags:!0},[e]),(0,K.vC)("esc",()=>{var n;e&&(null===(n=x.current)||void 0===n?void 0:n.contains(document.activeElement))&&t((0,j.iv)(!1))},{enableOnFormTags:!0},[e]),(0,p.useEffect)(()=>{let t=t=>{var n;if(!e||!(null===(n=x.current)||void 0===n?void 0:n.contains(document.activeElement)))return;let l=Array.from(x.current.querySelectorAll('div[role="button"], button, [tabindex="0"]'));switch(t.key){case"ArrowDown":t.preventDefault(),w(e=>e<l.length-1?e+1:e);break;case"ArrowUp":t.preventDefault(),w(e=>e>0?e-1:e);break;case"Enter":t.preventDefault(),f>=0&&f<l.length&&l[f].click()}};return e&&window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[e,f]),(0,p.useEffect)(()=>{e||w(-1)},[e]),(0,p.useEffect)(()=>{e&&h.current&&h.current.focus()},[e]);let y=e=>{a&&((0,C.ff)(n,o,e,a,t),t((0,j.iv)(!1)))};(0,p.useEffect)(()=>{m(Object.keys(o).reduce((e,t)=>{if(0===r.trim().length)return o;let n=o[t].filter(e=>e.name.toLowerCase().includes(r.toLowerCase()));return n.length>0&&(e[t]=n,u(e=>{let n=new Set(e);return n.has(t)||n.add(t),n})),e},{}))},[o,r]);let b=e=>e.reduce((e,t)=>{let n=t.category||"Other";if(!e[n]){var l,o;e[n]={nodes:[],logo:t.logo,color:null===(l=t.visual_tag)||void 0===l?void 0:l.color,acronym:null===(o=t.visual_tag)||void 0===o?void 0:o.acronym}}return e[n].nodes.push(t),e},{});return(0,l.jsxs)("div",{ref:x,"data-node-panel":!0,"data-expanded":e,className:"".concat(e?"w-64":"w-auto h-auto"," shadow-sm rounded-xl border border-solid border-default-200 bg-background transition-width duration-300 transition-height duration-300"),children:[(0,l.jsx)(A.I,{content:(0,l.jsxs)("div",{className:"px-1 py-2",children:[(0,l.jsx)("div",{className:"text-small font-bold",children:"Keyboard Shortcuts"}),(0,l.jsxs)("div",{className:"text-tiny",children:["Press ",navigator.platform.includes("Mac")?"âŒ˜+K":"Ctrl+K"," or ",(0,l.jsx)("kbd",{children:"K"})," to toggle panel"]})]}),placement:"right",children:(0,l.jsx)(O.T,{isIconOnly:!0,size:"md",className:"bg-background",onClick:()=>{t((0,j.iv)(!e))},children:(0,l.jsx)(d.In,{icon:e?"solar:minus-square-linear":"solar:widget-add-linear",width:"80%",className:"text-default-500"})})}),e&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(_.r,{ref:h,id:"node-search-input",type:"search",placeholder:"Search nodes...",value:r,onChange:e=>s(e.target.value),fullWidth:!0,className:"px-2 rounded",startContent:(0,l.jsx)(d.In,{icon:"akar-icons:search",className:"text-default-500"})}),(0,l.jsx)("div",{className:"mt-4 max-h-[calc(100vh-16rem)] overflow-auto",id:"node-type-accordion",children:(0,l.jsx)(D.D,{selectionMode:"multiple",selectedKeys:Array.from(i),onSelectionChange:e=>u(new Set(Array.from(e))),children:Object.keys(g).filter(e=>"Input/Output"!==e).map(e=>{let t=g[e],n=t.some(e=>e.category);return(0,l.jsx)(L.R,{title:e,textValue:e,children:n?(0,l.jsx)(D.D,{selectionMode:"multiple",children:Object.entries(b(t)).map(e=>{let[t,{nodes:n,logo:o,color:a,acronym:r}]=e;return(0,l.jsx)(L.R,{textValue:t,title:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"w-8 flex-shrink-0",children:o?(0,l.jsx)("img",{src:o,alt:"".concat(t," Logo"),className:"max-h-5 max-w-5"}):(0,l.jsx)("div",{className:"node-acronym-tag float-left text-white px-2 py-1 rounded-full text-xs inline-block",style:{backgroundColor:a},children:r})}),(0,l.jsx)("span",{children:t})]}),children:n.map(e=>(0,l.jsx)("div",{className:"flex items-center cursor-pointer p-2 hover:bg-default-100 ml-4",onClick:()=>y(e.name),children:(0,l.jsx)("span",{className:"flex-grow overflow-hidden text-ellipsis whitespace-nowrap text-foreground",title:e.config.title,children:e.config.title})},e.name))},t)})}):g[e].map(e=>(0,l.jsxs)("div",{className:"flex items-center cursor-pointer p-2 hover:bg-default-100",onClick:()=>y(e.name),children:[(0,l.jsx)("div",{className:"w-16 flex-shrink-0",children:e.logo?(0,l.jsx)("img",{src:e.logo,alt:"Node Logo",className:"max-h-7 max-w-7"}):(0,l.jsx)("div",{className:"node-acronym-tag float-left text-white px-2 py-1 rounded-full text-xs inline-block",style:{backgroundColor:e.visual_tag.color},children:e.visual_tag.acronym})}),(0,l.jsx)("span",{className:"flex-grow overflow-hidden text-ellipsis whitespace-nowrap text-foreground",title:e.config.title,children:e.config.title})]},e.name))},e)})})})]})]})};var M=n(46421),V=n(43346),Y=n(80893),z=n(36240);let F={custom:Y.A},R=e=>e.reduce((e,t)=>{let n=t.category||"Other";if(!e[n]){var l,o;e[n]={nodes:[],logo:t.logo,color:null===(l=t.visual_tag)||void 0===l?void 0:l.color,acronym:null===(o=t.visual_tag)||void 0===o?void 0:o.acronym}}return e[n].nodes.push(t),e},{}),W=e=>{let{workflowData:t,workflowID:n,onDownloadImageInit:m,extraPanelButtons:x,renderNodeSidebarExternally:N=!1}=e,E=(0,v.wA)(),A=(0,v.d4)(e=>e.flow.projectName),O=(0,v.d4)(e=>e.nodeTypes.data),{nodeTypes:_,isLoading:D}=(0,C.Tj)({nodeTypesConfig:O,readOnly:!1,includeCoalesceNode:!0});(0,p.useEffect)(()=>{t&&E((0,b.R$)({nodeTypes:O,definition:t.definition,workflowID:n,name:t.name}))},[E,t,n,O]);let L=(0,v.d4)(e=>e.flow.nodes,f()),K=(0,v.d4)(e=>e.flow.edges,f()),Y=(0,v.d4)(e=>e.flow.nodeConfigs,f()),W=(0,v.d4)(e=>e.flow.selectedNode),B=(0,v.d4)(e=>e.flow.selectedEdgeId),P=(0,y.y)();(0,p.useEffect)(()=>{(L.length>0||K.length>0||Object.keys(Y).length>0)&&P()},[L,K,Y,P]);let[Q,U]=(0,p.useState)(null),[q,H]=(0,p.useState)({horizontal:null,vertical:null}),[Z,G]=(0,p.useState)(null),[J,X]=(0,p.useState)(null),[$,ee]=(0,p.useState)(!1),[et,en]=(0,p.useState)(null),[el,eo]=(0,p.useState)({x:0,y:0}),[ea,er]=(0,p.useState)(new Set),[es,ei]=(0,p.useState)(new Set(["AI","Code Execution","Logic","Experimental","Integrations"])),ed=(0,k.y)(e=>e.mode),{getIntersectingNodes:ec,getNodes:eu,updateNode:eg,getViewport:em}=(0,c.VH)(),eh=(0,p.useCallback)(e=>{let{sourceNode:t,targetNode:n,edgeId:l}=e;if(!Q)return;let o=(t.position.x+n.position.x)/2,a=(t.position.y+n.position.y)/2,r=Q.flowToScreenPosition({x:o,y:a});eo({x:r.x,y:r.y}),en({sourceNode:t,targetNode:n,edgeId:l}),ee(!0)},[Q]),{onNodesChange:ex,onEdgesChange:ef,onConnect:ep,onNodeDragStop:ev}=(0,C.dW)({dispatch:E,nodes:L,setHelperLines:H}),ew=(0,C.Bf)({edges:K,hoveredNode:Z,hoveredEdge:J,selectedEdgeId:B,handlePopoverOpen:eh}),ey=(0,C.ml)({nodes:L,mode:ed}),eb=(0,C.Fu)({nodes:ey}),ek=(0,p.useCallback)((e,t)=>{X(t.id)},[X]),ej=(0,p.useCallback)(()=>{X(null)},[X]),eC=(0,p.useCallback)(e=>{U(e),e.setViewport({x:0,y:0,zoom:.8})},[]),eN=(0,p.useCallback)((e,t)=>{E((0,b.Qi)({nodeId:t.id}))},[E]),eE=(0,p.useCallback)((e,t)=>{E((0,b.Yy)({edgeId:t.id}))},[E]),eS=(0,p.useCallback)(()=>{W&&E((0,b.Qi)({nodeId:null})),B&&E((0,b.Yy)({edgeId:null})),E((0,j.iv)(!1))},[E,W,B]),eI=(0,p.useCallback)(e=>{e.forEach(e=>{E((0,b.AC)({nodeId:e.id})),W===e.id&&E((0,b.Qi)({nodeId:null}))})},[E,W]),eA=(0,p.useCallback)(e=>{let t=e.target,n=t.tagName.toLowerCase();if(t.isContentEditable||"input"===n||"textarea"===n||"select"===n)return;let l=document.querySelector("[data-node-panel]"),o=(null==l?void 0:l.getAttribute("data-expanded"))==="true",a=null==l?void 0:l.contains(document.activeElement);if("Delete"===e.key||"Backspace"===e.key){let e=L.filter(e=>e.selected);e.length>0&&eI(e);return}if(o&&a)return;let r=e.shiftKey?45:15;if(Q){let{x:t,y:n,zoom:l}=Q.getViewport();switch(e.key){case"ArrowLeft":Q.setViewport({x:t+r,y:n,zoom:l});break;case"ArrowRight":Q.setViewport({x:t-r,y:n,zoom:l});break;case"ArrowUp":Q.setViewport({x:t,y:n+r,zoom:l});break;case"ArrowDown":Q.setViewport({x:t,y:n-r,zoom:l})}}},[L,eI,Q]),eO=(0,p.useCallback)(()=>{let e=(0,o.B)(L,K);E((0,b.CU)({nodes:e}))},[L,K,E]);(0,p.useEffect)(()=>(window.addEventListener("keydown",eA),()=>{window.removeEventListener("keydown",eA)}),[eA]),(0,w.K)(W,L,_,O,E,eO);let{cut:e_,copy:eD,paste:eL,bufferedNodes:eK}=S();S();let eT=(0,p.useCallback)((e,t)=>{G(t.id)},[G]),eM=(0,p.useCallback)(()=>{G(null)},[G]),eV=(0,p.useCallback)((e,t,n,l)=>{(0,C.HB)(L,O,e,t,n,l,E,()=>ee(!1))},[L,O,Q,E,ee]),eY=(0,p.useCallback)(h()((e,t)=>{(0,M.tJ)(e,t,L,E,ec,eu,eg)},16),[L,E,ec]),ez=(0,p.useCallback)((e,t)=>{(0,M.Lm)(e,t,L,K,E,ec,eu,eg),ev(e,t)},[L,K,E,ec,eu,eg,ev]),eF=e=>{er(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},eR=e=>{ei(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},eW=(0,p.useCallback)(()=>{let e=eu(),t=(0,u.Jo)(e),n=t.width||1,l=t.height||1,o=Math.min(1080/n,607.5/l),a=(0,u.R4)(t,1200,675,o,o,.05*Math.min(n,l));(0,g.$E)(document.querySelector(".react-flow__viewport"),{backgroundColor:"transparent",width:1200,height:675,style:{width:"".concat(1200,"px"),height:"".concat(675,"px"),transform:"translate(".concat(a.x,"px, ").concat(a.y,"px) scale(").concat(a.zoom,")")}}).then(e=>{let t=document.createElement("a");t.href=e,t.download="".concat(A,".png"),t.click()}).catch(e=>{console.error("Failed to download image",e)})},[eu,A]);return((0,p.useEffect)(()=>{m&&m(eW)},[eW,m]),D)?(0,l.jsx)(I.A,{}):(0,l.jsxs)("div",{style:{position:"relative",height:"100%"},children:[$&&et&&(0,l.jsx)("div",{style:{position:"absolute",left:"".concat(el.x,"px"),top:"".concat(el.y,"px"),transform:"translate(-50%, -50%)",zIndex:1e3},children:(0,l.jsxs)(a.A,{isOpen:$,onOpenChange:e=>{e||ee(!1)},placement:"bottom",children:[(0,l.jsx)(r.b,{children:(0,l.jsx)("div",{})}),(0,l.jsx)(s.y,{"aria-label":"Add node options",closeOnSelect:!1,onAction:e=>{let t=e.toString();if(t.startsWith("toggle-category-")){eR(t.replace("toggle-category-",""));return}if(t.startsWith("toggle-")){eF(t.replace("toggle-",""));return}eV(t,et.sourceNode,et.targetNode,et.edgeId),ee(!1)},children:O&&Object.keys(O).filter(e=>"Input/Output"!==e).map(e=>{let t=O[e],n=t.some(e=>e.category);return(0,l.jsxs)(p.Fragment,{children:[(0,l.jsx)(i.Y,{className:"font-bold opacity-70 flex items-center gap-2",startContent:(0,l.jsx)(d.In,{icon:es.has(e)?"solar:alt-arrow-down-linear":"solar:alt-arrow-right-linear",className:"text-default-500"}),children:e},"toggle-category-".concat(e)),es.has(e)&&("Integrations"===e?Object.entries(R(t)).map(e=>{let[t,{nodes:n}]=e;return(0,l.jsxs)(p.Fragment,{children:[(0,l.jsx)(i.Y,{className:"font-semibold pl-4 flex items-center gap-2",startContent:(0,l.jsx)(d.In,{icon:ea.has(t)?"solar:alt-arrow-down-linear":"solar:alt-arrow-right-linear",className:"text-default-500"}),children:t},"toggle-".concat(t)),ea.has(t)&&n.map(e=>{var t,n;return(0,l.jsx)(i.Y,{className:"pl-8",startContent:e.logo?(0,l.jsx)("img",{src:e.logo,alt:"".concat(e.config.title," Logo"),className:"w-5 h-5"}):(0,l.jsx)("div",{className:"node-acronym-tag text-white px-2 py-1 rounded-full text-xs",style:{backgroundColor:null===(t=e.visual_tag)||void 0===t?void 0:t.color},children:null===(n=e.visual_tag)||void 0===n?void 0:n.acronym}),children:e.config.title},e.name)})]},t)}):n?Object.entries(R(t)).map(e=>{let[t,{nodes:n}]=e;return(0,l.jsxs)(p.Fragment,{children:[(0,l.jsx)(i.Y,{className:"font-semibold opacity-70 pl-4",isReadOnly:!0,children:t},"".concat(t,"-header")),n.map(e=>{var t,n;return(0,l.jsx)(i.Y,{className:"pl-8",startContent:e.logo?(0,l.jsx)("img",{src:e.logo,alt:"".concat(e.config.title," Logo"),className:"w-5 h-5"}):(0,l.jsx)("div",{className:"node-acronym-tag text-white px-2 py-1 rounded-full text-xs",style:{backgroundColor:null===(t=e.visual_tag)||void 0===t?void 0:t.color},children:null===(n=e.visual_tag)||void 0===n?void 0:n.acronym}),children:e.config.title},e.name)})]},t)}):t.map(e=>{var t,n;return(0,l.jsx)(i.Y,{className:"pl-4",startContent:e.logo?(0,l.jsx)("img",{src:e.logo,alt:"".concat(e.config.title," Logo"),className:"w-5 h-5"}):(0,l.jsx)("div",{className:"node-acronym-tag text-white px-2 py-1 rounded-full text-xs",style:{backgroundColor:null===(t=e.visual_tag)||void 0===t?void 0:t.color},children:null===(n=e.visual_tag)||void 0===n?void 0:n.acronym}),children:e.config.title},e.name)}))]},e)})})]})}),(0,l.jsxs)("div",{style:{width:"100%",height:"100%",overflow:"hidden"},children:[(0,l.jsx)("div",{style:{height:"100%",overflow:"auto",position:"relative",zIndex:1},children:(0,l.jsxs)(c.Gc,{nodes:eb,edges:ew,onNodesChange:ex,onEdgesChange:ef,onConnect:ep,nodeTypes:_,edgeTypes:F,fitView:!0,onInit:eC,onNodeClick:eN,onEdgeClick:eE,onPaneClick:eS,onNodesDelete:eI,proOptions:{hideAttribution:!0},panOnDrag:"hand"===ed&&!L.filter(Boolean).some(e=>e.selected),panOnScroll:!0,zoomOnScroll:!0,minZoom:.1,maxZoom:2,selectionMode:"pointer"===ed?u.Qc.Full:u.Qc.Partial,selectNodesOnDrag:"pointer"===ed,selectionOnDrag:"pointer"===ed,selectionKeyCode:"pointer"===ed?null:"Shift",multiSelectionKeyCode:"pointer"===ed?null:"Shift",deleteKeyCode:"Delete",nodesConnectable:!0,connectionMode:u.WZ.Loose,onNodeMouseEnter:eT,onNodeMouseLeave:eM,onEdgeMouseEnter:ek,onEdgeMouseLeave:ej,snapToGrid:!1,onNodeDrag:eY,onNodeDragStop:ez,children:[(0,l.jsx)(c.VS,{}),!1,(0,l.jsx)(z.A,{handleLayout:eO,handleDownloadImage:eW}),x&&(0,l.jsx)(c.Zk,{position:"top-right",children:x})]})}),W&&!N&&(0,l.jsx)("div",{className:"absolute top-0 right-0 h-full bg-background dark:bg-background/80 border-l border-divider",style:{zIndex:30},children:(0,l.jsx)(V.A,{nodeID:W,readOnly:!1},W)}),(0,l.jsx)("div",{className:"border-divider absolute top-4 left-4",style:{zIndex:15},children:(0,l.jsx)(T,{})})]})]})},B=e=>{let{workflowData:t,workflowID:n,onDownloadImageInit:o,extraPanelButtons:a,renderNodeSidebarExternally:r=!1}=e;return(0,l.jsx)(c.Ln,{children:(0,l.jsx)(W,{workflowData:t,workflowID:n,onDownloadImageInit:o,extraPanelButtons:a,renderNodeSidebarExternally:r})})}}}]);