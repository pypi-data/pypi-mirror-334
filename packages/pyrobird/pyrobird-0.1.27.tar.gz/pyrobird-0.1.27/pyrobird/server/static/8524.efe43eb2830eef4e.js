"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[8524],{8524:(I,D,o)=>{o.r(D),o.d(D,{TF3Painter:()=>C});var X=o(467),_=o(6998),b=o(4149),H=o(3693),O=o(230),j=o(9041),L=o(675),W=o(3277);function N(E,i,e=0){for(let t=E.length-2;t>=0;--t){const r=i[t],x=i[t+1],m=E[t],l=E[t+1];if(r===e)return m;if(x===e)return l;if(r<e!=x<e)return m+(e-r)/(x-r)*(l-m)}return E[0]-1}class C extends b.TH2Painter{getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??_.clTF3}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(i){if(!i||this.getClassName()!==i._typename)return!1;delete i.evalPar;const e=this.getHisto();if(this.webcanv_hist){const t=this.getPadPainter()?.findInPrimitives("Func",_.clTH2F);t&&this.updateAxes(e,t,this.getFramePainter())}return this.$func=i,this.createTF3Histogram(i,e),this.scanContent(),!0}redraw(i){return!this._use_saved_points&&("logx"===i||"logy"===i||"logy"===i||"zoom"===i)&&(this.createTF3Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(i)}createTF3Histogram(i,e){const t=i.fSave.length-9;this._use_saved_points=t>0&&(_.settings.PreferSavedPoints||this.use_saved>1);const r=this.getFramePainter(),x=this.getPadPainter()?.getRootPad(!0),m=x?.fLogx,l=x?.fLogy,a=r?.getGrFuncs(this.second_x,this.second_y);let z=i.fXmin,M=i.fXmax,y=i.fYmin,P=i.fYmax,h=i.fZmin,c=i.fZmax,g=Math.max(i.fNpx,20),u=Math.max(i.fNpy,20),f=Math.max(i.fNpz,20);if(a?.zoom_xmin!==a?.zoom_xmax){const s=(M-z)/g;z<a.zoom_xmin&&a.zoom_xmin<M&&(z=Math.max(z,a.zoom_xmin-s)),z<a.zoom_xmax&&a.zoom_xmax<M&&(M=Math.min(M,a.zoom_xmax+s))}if(a?.zoom_ymin!==a?.zoom_ymax){const s=(P-y)/u;y<a.zoom_ymin&&a.zoom_ymin<P&&(y=Math.max(y,a.zoom_ymin-s)),y<a.zoom_ymax&&a.zoom_ymax<P&&(P=Math.min(P,a.zoom_ymax+s))}a?.zoom_zmin!==a?.zoom_zmax&&(h<a.zoom_zmin&&a.zoom_zmin<c&&(h=a.zoom_zmin),h<a.zoom_zmax&&a.zoom_zmax<c&&(c=a.zoom_zmax));const p=(s,d)=>{e.fNcells!==(s+2)*(d+2)&&(e.fNcells=(s+2)*(d+2),e.fArray=new Float32Array(e.fNcells)),e.fArray.fill(0),e.fXaxis.fNbins=s,e.fXaxis.fXbins=[],e.fYaxis.fNbins=d,e.fYaxis.fXbins=[],e.fXaxis.fXmin=z,e.fXaxis.fXmax=M,e.fYaxis.fXmin=y,e.fYaxis.fXmax=P,e.fMinimum=h,e.fMaximum=c};if(delete this._fail_eval,!this._use_saved_points){let s=!1;!i.evalPar&&!(0,H.Dx)(i)&&(s=!0),p(g,u),m&&(0,O.produceTAxisLogScale)(e.fXaxis,g,z,M),l&&(0,O.produceTAxisLogScale)(e.fYaxis,u,y,P);const d=new Array(f),S=new Array(f);for(let n=0;n<f;++n)S[n]=h+n/(f-1)*(c-h);for(let n=0;n<u&&!s;++n)for(let v=0;v<g&&!s;++v){const A=e.fXaxis.GetBinCenter(v+1),T=e.fYaxis.GetBinCenter(n+1);let B=0;try{for(let F=0;F<f;++F)d[F]=i.evalPar(A,T,S[F]);B=N(S,d)}catch{s=!0}s||e.setBinContent(e.getBin(v+1,n+1),Number.isFinite(B)?B:0)}s&&(this._fail_eval=!0),s&&t>0&&(this._use_saved_points=!0)}if(this._use_saved_points){z=i.fSave[t],M=i.fSave[t+1],y=i.fSave[t+2],P=i.fSave[t+3],h=i.fSave[t+4],c=i.fSave[t+5],g=Math.round(i.fSave[t+6]),u=Math.round(i.fSave[t+7]),f=Math.round(i.fSave[t+8]);const s=(c-h)/f;p(g+1,u+1);const d=new Array(f+1),S=new Array(f+1);for(let n=0;n<=f;n++)S[n]=h+n*s;for(let n=0;n<=g;++n)for(let v=0;v<=u;++v){for(let T=0;T<=f;T++)d[T]=i.fSave[n+(g+1)*(v+(u+1)*T)];const A=N(S,d);e.setBinContent(e.getBin(n+1,v+1),Number.isFinite(A)?A:0)}}return e.fName="Func",(0,_.setHistogramTitle)(e,i.fTitle),e.fLineColor=i.fLineColor,e.fLineStyle=i.fLineStyle,e.fLineWidth=i.fLineWidth,e.fFillColor=i.fFillColor,e.fFillStyle=i.fFillStyle,e.fMarkerColor=i.fMarkerColor,e.fMarkerStyle=i.fMarkerStyle,e.fMarkerSize=i.fMarkerSize,e.fBits|=_.kNoStats,e}extractAxesProperties(i){super.extractAxesProperties(i);const e=this.$func,t=e?.fSave.length??0;t>9&&this._use_saved_points&&(this.xmin=Math.min(this.xmin,e.fSave[t-9]),this.xmax=Math.max(this.xmax,e.fSave[t-8]),this.ymin=Math.min(this.ymin,e.fSave[t-7]),this.ymax=Math.max(this.ymax,e.fSave[t-6]),this.zmin=Math.min(this.zmin,e.fSave[t-5]),this.zmax=Math.max(this.zmax,e.fSave[t-4])),e&&(this.xmin=Math.min(this.xmin,e.fXmin),this.xmax=Math.max(this.xmax,e.fXmax),this.ymin=Math.min(this.ymin,e.fYmin),this.ymax=Math.max(this.ymax,e.fYmax),this.zmin=Math.min(this.zmin,e.fZmin),this.zmax=Math.max(this.zmax,e.fZmax))}fillWebObjectOptions(i){i.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static draw(i,e,t){return(0,X.A)(function*(){const r=(0,O.scanTF1Options)(t);t=r.opt,delete r.opt;const x=new j.nC(t);let m;x.empty()||"gl"===t?t="surf1":"SAME"===x.opt&&(t="surf1 same"),(0===t.indexOf("same")||0===t.indexOf("SAME"))&&((0,L.Nn)(i)||(t="A_ADJUST_FRAME_"+t.slice(4))),r.webcanv_hist&&(m=new L.JW(i).getPadPainter()?.findInPrimitives("Func",_.clTH2F)),m||(m=(0,_.createHistogram)(_.clTH2F,20,20),m.fBits|=_.kNoStats);const l=new C(i,m);return l.$func=e,Object.assign(l,r),l.createTF3Histogram(e,m),W.mf._drawHist(l,t)})()}}}}]);