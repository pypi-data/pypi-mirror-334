"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[921],{921:(mt,Q,O)=>{O.r(Q),O.d(Q,{TGraph2DPainter:()=>$});var R=O(467),Z=O(6998),Nt=O(9041),ct=O(675),dt=O(4149),ut=O(4571),C=O(3366),V=O(9407);function tt(z){let i=z[0];for(let h=1;h<z.length;++h)i=Math.max(i,z[h]);return i}function it(z){let i=z[0];for(let h=1;h<z.length;++h)i=Math.min(i,z[h]);return i}class Yt{constructor(i){this.fGraph2D=i,this.fX=i.fX,this.fY=i.fY,this.fZ=i.fZ,this.fNpoints=i.fNpoints,this.fZout=0,this.fNdt=0,this.fNhull=0,this.fHullPoints=null,this.fXN=null,this.fYN=null,this.fOrder=null,this.fDist=null,this.fPTried=null,this.fNTried=null,this.fMTried=null,this.fInit=!1,this.fXNmin=0,this.fXNmax=0,this.fYNmin=0,this.fYNmax=0,this.fXoffset=0,this.fYoffset=0,this.fXScaleFactor=0,this.fYScaleFactor=0,this.SetMaxIter()}Initialize(){this.fInit||(this.CreateTrianglesDataStructure(),this.FindHull(),this.fInit=!0)}ComputeZ(i,h){this.Initialize();const s=(i+this.fXoffset)*this.fXScaleFactor,t=(h+this.fYoffset)*this.fYScaleFactor;let l=this.Interpolate(s,t);return 0===l&&(l=this.Interpolate(s+1e-4,t)),l}CreateTrianglesDataStructure(){const i=tt(this.fGraph2D.fX),h=tt(this.fGraph2D.fY),s=it(this.fGraph2D.fX),t=it(this.fGraph2D.fY);this.fXoffset=-(i+s)/2,this.fYoffset=-(h+t)/2,this.fXScaleFactor=1/(i-s),this.fYScaleFactor=1/(h-t),this.fXNmax=(i+this.fXoffset)*this.fXScaleFactor,this.fXNmin=(s+this.fXoffset)*this.fXScaleFactor,this.fYNmax=(h+this.fYoffset)*this.fYScaleFactor,this.fYNmin=(t+this.fYoffset)*this.fYScaleFactor,this.fXN=new Array(this.fNpoints+1),this.fYN=new Array(this.fNpoints+1);for(let l=0;l<this.fNpoints;l++)this.fXN[l+1]=(this.fX[l]+this.fXoffset)*this.fXScaleFactor,this.fYN[l+1]=(this.fY[l]+this.fYoffset)*this.fYScaleFactor;this.fPTried=[],this.fNTried=[],this.fMTried=[]}Enclose(i,h,s,t){const l=[this.fXN[i],this.fXN[h],this.fXN[s],this.fXN[i]],r=[this.fYN[i],this.fYN[h],this.fYN[s],this.fYN[i]],o=this.fXN[t],n=this.fYN[t];let M=0,X=l.length-1,Y=!1;for(;M<l.length;++M)(r[M]<n&&r[X]>=n||r[X]<n&&r[M]>=n)&&l[M]+(n-r[M])/(r[X]-r[M])*(l[X]-l[M])<o&&(Y=!Y),X=M;return Y}FileIt(i,h,s){let t,l,r=i,o=h,n=s;do{t=!1,o>r&&(l=r,r=o,o=l,t=!0),n>o&&(l=o,o=n,n=l,t=!0)}while(t);this.fNdt++,this.fPTried.push(r),this.fNTried.push(o),this.fMTried.push(n)}FindAllTriangles(){if(this.fAllTri)return;this.fAllTri=!0;let i,h,s,t,l,r,o,n,M,X,Y,N,e,a,c,f,d,T,y,u,m,_,p,E,g,P=0,x=0,w=0;const I=[!1,!1,!1],D=1e-4;for(this.Initialize(),i=0,h=0,g=1;g<=this.fNhull;g++)i+=this.fXN[this.fHullPoints[g-1]],h+=this.fYN[this.fHullPoints[g-1]];for(i=i/this.fNhull+D,h=h/this.fNhull+D,this.Interpolate(i,h),f=1;f<=this.fNdt;){for(T=this.fPTried[f-1],y=this.fNTried[f-1],u=this.fMTried[f-1],I[0]=!1,I[1]=!1,I[2]=!1,d=1;d<=this.fNdt;d++)d!==f&&(m=this.fPTried[d-1],_=this.fNTried[d-1],p=this.fMTried[d-1],T===m&&y===_||T===m&&y===p||T===_&&y===p?I[0]=!0:T===m&&u===_||T===m&&u===p||T===_&&u===p?I[1]=!0:(y===m&&u===_||y===m&&u===p||y===_&&u===p)&&(I[2]=!0));for(E=1;E<=3;E++)I[E-1]||(1===E?(P=T,x=y,w=u):2===E?(P=T,x=u,w=y):3===E&&(P=y,x=u,w=T),s=(this.fXN[P]+this.fXN[x])/2,t=(this.fYN[P]+this.fYN[x])/2,o=this.fXN[P]-this.fXN[x],n=this.fYN[P]-this.fYN[x],M=n,X=-o,a=Math.sqrt(M*M+X*X),M/=a,X/=a,Y=this.fXN[w]-s,N=this.fYN[w]-t,e=Y*M+N*X,e>0&&(M=-M,X=-X),c=Math.abs(Math.max(D*s,D*t)),l=s+M*c,r=t+X*c,this.Interpolate(l,r));f++}}FindHull(){this.fHullPoints||(this.fHullPoints=new Array(this.fNpoints));let i=0;for(let h=1;h<=this.fNpoints;h++)this.InHull(h,h)||(i++,this.fHullPoints[i-1]=h);this.fNhull=i}InHull(i,h){let s,t,l,r,o,n,M,X,Y,N,e,a,c,f,d,T,y,u,m,_,p,P=!1;const x=this.fXN[i],E=this.fYN[i];for(o=this.fNhull>0?this.fNhull:this.fNpoints,s=1,t=2,s===h?(s=t,t++):t===h&&t++,Y=x-this.fXN[s],a=E-this.fYN[s],N=x-this.fXN[t],c=E-this.fYN[t],m=Math.atan2(a,Y),_=Math.atan2(c,N),p=m-_-Math.floor((m-_)/(2*Math.PI))*Math.PI*2,p<0&&(p+=2*Math.PI),n=p,l=1;l<=o;l++)if(r=this.fNhull>0?this.fHullPoints[l-1]:l,r!==s&&r!==t&&r!==h&&(Y=x-this.fXN[s],a=E-this.fYN[s],N=x-this.fXN[t],c=E-this.fYN[t],e=x-this.fXN[r],f=E-this.fYN[r],M=N*a-Y*c,X=Y*c-N*a,M*X!=0&&(d=(N*f-e*c)/M,T=(Y*f-e*a)/X,d<0||T<0))){if(y=(Y*e+a*f)/Math.sqrt(Y*Y+a*a),u=(N*e+c*f)/Math.sqrt(N*N+c*c),y>u?(s=r,m=Math.atan2(f,e),_=Math.atan2(c,N)):(t=r,m=Math.atan2(a,Y),_=Math.atan2(f,e)),p=m-_-Math.floor((m-_)/(2*Math.PI))*Math.PI*2,p<0&&(p+=2*Math.PI),(p-Math.PI)*(n-Math.PI)<0)return P=!0,P;n=p}return P}InterpolateOnPlane(i,h,s,t){let l,r,o=i,n=h,M=s;do{r=!1,n>o&&(l=o,o=n,n=l,r=!0),M>n&&(l=n,n=M,M=l,r=!0)}while(r);const X=this.fXN[o],Y=this.fXN[n],N=this.fXN[M],e=this.fYN[o],a=this.fYN[n],c=this.fYN[M],f=this.fZ[o-1],d=this.fZ[n-1],T=this.fZ[M-1],y=(f*(a-c)+d*(c-e)+T*(e-a))/(X*(a-c)+Y*(c-e)+N*(e-a)),u=(f*(Y-N)+d*(N-X)+T*(X-Y))/(e*(Y-N)+a*(N-X)+c*(X-Y));return y*this.fXN[t]+u*this.fYN[t]+(f-y*X-u*e)}Interpolate(i,h){let s,t,l,r,o,n,M,X,Y,N,e,a,c,f,d,T,y,u,m,_,w,I,D,A,v,H,L,st,et,ft,ht,K,q,rt,nt,S,j,U,B,G,J,at,lt,p=0,P=0,x=0,E=0,g=0;const b=[0,0,0],k=[0,0,0];if(this.Initialize(),this.fOrder||(this.fOrder=new Array(this.fNpoints),this.fDist=new Array(this.fNpoints)),this.fXN[0]=i,this.fYN[0]=h,s=this.fZout,l=0,i>this.fXNmax||i<this.fXNmin||h>this.fYNmax||h<this.fYNmin)return s;for(t=1;t<=this.fNdt;t++)if(r=this.fPTried[t-1],o=this.fNTried[t-1],n=this.fMTried[t-1],this.Enclose(r,o,n,0))return s=this.InterpolateOnPlane(r,o,n,0),s;const ot=this.InHull(0,-1);if(!ot)return s;for(t=1;t<=this.fNpoints;t++)w=this.fXN[t],I=this.fYN[t],this.fDist[t-1]=Math.sqrt((i-w)*(i-w)+(h-I)*(h-I));for(function Xt(z,i,h){const s=new Array(z);for(let t=0;t<z;++t)s[t]={v:i[t],i:t};s.sort((t,l)=>t.v<l.v?-1:t.v>l.v?1:0);for(let t=0;t<z;++t)h[t]=s[t].i}(this.fNpoints,this.fDist,this.fOrder),t=0;t<this.fNpoints;t++)this.fOrder[t]++;for(Y=3;Y<=this.fNpoints;Y++)for(n=this.fOrder[Y-1],X=2;X<=Y-1;X++)for(o=this.fOrder[X-1],M=1;M<=X-1;M++){let F=!1;if(r=this.fOrder[M-1],l>this.fMaxIter)return s;if(l++,D=Math.sqrt((this.fXN[r]-this.fXN[o])**2+(this.fYN[r]-this.fYN[o])**2),A=Math.sqrt((this.fXN[r]-this.fXN[n])**2+(this.fYN[r]-this.fYN[n])**2),v=Math.sqrt((this.fXN[o]-this.fXN[n])**2+(this.fYN[o]-this.fYN[n])**2),!(D+A<=v||D+v<=A||A+v<=D)&&this.Enclose(r,o,n,0)){for(p=0,e=1;e<=this.fNpoints;e++)if(e!==r&&e!==o&&e!==n){for(N=1;N<=this.fNpoints;N++)if(this.fOrder[N-1]===e){if(!(N<M||N<X||N<Y))break;if(this.Enclose(r,o,n,e)){F=!0;break}}if(F)break;if((this.fXN[r]-this.fXN[e])*(this.fYN[r]-this.fYN[o])==(this.fYN[r]-this.fYN[e])*(this.fXN[r]-this.fXN[o])?(T=r,y=o):(this.fXN[r]-this.fXN[e])*(this.fYN[r]-this.fYN[n])==(this.fYN[r]-this.fYN[e])*(this.fXN[r]-this.fXN[n])?(T=r,y=n):(this.fXN[o]-this.fXN[e])*(this.fYN[o]-this.fYN[n])==(this.fYN[o]-this.fYN[e])*(this.fXN[o]-this.fXN[n])?(T=o,y=n):(T=0,y=0),0!==T){if(this.fXN[T]!==this.fXN[y]){if((this.fXN[e]-this.fXN[T])*(this.fXN[e]-this.fXN[y])<0){F=!0;break}(this.fXN[e]-this.fXN[T])*(this.fXN[e]-this.fXN[y])==0&&console.warn(`Interpolate Two of these three points are coincident ${T} ${y} ${e}`)}else{if((this.fYN[e]-this.fYN[T])*(this.fYN[e]-this.fYN[y])<0){F=!0;break}(this.fYN[e]-this.fYN[T])*(this.fYN[e]-this.fYN[y])==0&&console.warn(`Interpolate Two of these three points are coincident ${T} ${y} ${e}`)}continue}if(F)break;for(a=n,f=r,d=o,b[0]=this.fXN[r]-this.fXN[e],k[0]=this.fYN[r]-this.fYN[e],b[1]=this.fXN[o]-this.fXN[e],k[1]=this.fYN[o]-this.fYN[e],b[2]=this.fXN[n]-this.fXN[e],k[2]=this.fYN[n]-this.fYN[e],N=1;N<=3;N++)if(S=b[N-1],j=b[N%3],U=b[(N+1)%3],B=k[N-1],G=k[N%3],J=k[(N+1)%3],at=(J*j-U*G)*(B*j-S*G),lt=(J*S-U*B)*(G*S-j*B),at>=0&&lt>=0){1===N?(a=n,f=r,d=o):2===N?(a=r,f=o,d=n):(a=o,f=n,d=r);break}if(q=((this.fXN[a]-this.fXN[f])*(this.fXN[e]-this.fXN[f])+(this.fYN[a]-this.fYN[f])*(this.fYN[e]-this.fYN[f]))/Math.sqrt(((this.fXN[a]-this.fXN[f])*(this.fXN[a]-this.fXN[f])+(this.fYN[a]-this.fYN[f])*(this.fYN[a]-this.fYN[f]))*((this.fXN[e]-this.fXN[f])*(this.fXN[e]-this.fXN[f])+(this.fYN[e]-this.fYN[f])*(this.fYN[e]-this.fYN[f]))),rt=((this.fXN[d]-this.fXN[f])*(this.fXN[e]-this.fXN[f])+(this.fYN[d]-this.fYN[f])*(this.fYN[e]-this.fYN[f]))/Math.sqrt(((this.fXN[d]-this.fXN[f])*(this.fXN[d]-this.fXN[f])+(this.fYN[d]-this.fYN[f])*(this.fYN[d]-this.fYN[f]))*((this.fXN[e]-this.fXN[f])*(this.fXN[e]-this.fXN[f])+(this.fYN[e]-this.fYN[f])*(this.fYN[e]-this.fYN[f]))),nt=((this.fXN[d]-this.fXN[f])*(this.fXN[a]-this.fXN[f])+(this.fYN[d]-this.fYN[f])*(this.fYN[a]-this.fYN[f]))/Math.sqrt(((this.fXN[d]-this.fXN[f])*(this.fXN[d]-this.fXN[f])+(this.fYN[d]-this.fYN[f])*(this.fYN[d]-this.fYN[f]))*((this.fXN[a]-this.fXN[f])*(this.fXN[a]-this.fXN[f])+(this.fYN[a]-this.fYN[f])*(this.fYN[a]-this.fYN[f]))),!(q>rt||q>nt)){if(st=Math.sqrt((this.fXN[e]-this.fXN[f])*(this.fXN[e]-this.fXN[f])+(this.fYN[e]-this.fYN[f])*(this.fYN[e]-this.fYN[f])),et=Math.sqrt((this.fXN[e]-this.fXN[d])*(this.fXN[e]-this.fXN[d])+(this.fYN[e]-this.fYN[d])*(this.fYN[e]-this.fYN[d])),ft=Math.sqrt((this.fXN[a]-this.fXN[f])*(this.fXN[a]-this.fXN[f])+(this.fYN[a]-this.fYN[f])*(this.fYN[a]-this.fYN[f])),ht=Math.sqrt((this.fXN[a]-this.fXN[d])*(this.fXN[a]-this.fXN[d])+(this.fYN[a]-this.fYN[d])*(this.fYN[a]-this.fYN[d])),H=((this.fXN[e]-this.fXN[f])*(this.fXN[e]-this.fXN[d])+(this.fYN[e]-this.fYN[f])*(this.fYN[e]-this.fYN[d]))/st/et,L=((this.fXN[a]-this.fXN[f])*(this.fXN[a]-this.fXN[d])+(this.fYN[a]-this.fYN[f])*(this.fYN[a]-this.fYN[d]))/ft/ht,K=H*Math.sqrt(1-L*L)+L*Math.sqrt(1-H*H),K<-1e-6){F=!0;break}Math.abs(K)<=1e-6&&(p++,P=e,x=a,E=f,g=d)}}if(!F)return p>0?(c=P,a=x,f=E,d=g,this.fZ[f-1]+this.fZ[d-1]>this.fZ[c-1]+this.fZ[a-1]?(u=r,m=o,_=n,this.FileIt(r,o,n),this.FileIt(c,f,d)):(u=a,m=c,_=this.Enclose(a,c,f,0)?f:d,this.FileIt(a,c,f),this.FileIt(a,c,d))):(this.FileIt(r,o,n),u=r,m=o,_=n),s=this.InterpolateOnPlane(u,m,_,0),s}}return ot&&console.error(`Interpolate Point outside hull when expected inside: this point could be dodgy ${i}  ${h} ${l}`),s}SetMaxIter(i=1e5){this.fAllTri=!1,this.fMaxIter=i}SetMarginBinsContent(i){this.fZout=i}}function W(z){let i=Math.floor(z.index/this.nvertex);if(i<0||i>=this.index.length)return null;const h=n=>n*n;i=this.index[i];const s=this.fp,t=this.graph;let l=s.grx(t.fX[i]),r=s.gry(t.fY[i]),o=s.grz(t.fZ[i]);if(this.check_next&&i+1<t.fX.length){const n=z.point,M=s.grx(t.fX[i+1]),X=s.gry(t.fY[i+1]),Y=s.grz(t.fZ[i+1]);h(n.x-M)+h(n.y-X)+h(n.z-Y)<h(n.x-l)+h(n.y-r)+h(n.z-o)&&(l=M,r=X,o=Y,i++)}return{x1:l-this.scale0,x2:l+this.scale0,y1:r-this.scale0,y2:r+this.scale0,z1:o-this.scale0,z2:o+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+i,"x: "+s.axisAsText("x",t.fX[i]),"y: "+s.axisAsText("y",t.fY[i]),"z: "+s.axisAsText("z",t.fZ[i])]}}class $ extends ct.JW{decodeOptions(i,h){const s=new Nt.nC(i);this.options||(this.options={});const t=this.options,l=this.getObject();s.check("FILL_","color")&&l&&(l.fFillColor=s.color),s.check("LINE_","color")&&l&&(l.fLineColor=s.color),s.check("SAME"),t.Triangles=s.check("TRI1")?11:s.check("TRI2")?10:s.check("TRIW")?1:s.check("TRI")?2:0,t.Line=s.check("LINE"),t.Error=s.check("ERR")&&(this.matchObjectType(Z.clTGraph2DErrors)||this.matchObjectType(Z.clTGraph2DAsymmErrors)),s.check("P0COL")?t.Color=t.Circles=t.Markers=!0:(t.Color=s.check("COL"),t.Circles=s.check("P0"),t.Markers=s.check("P")),t.Markers||(t.Color=!1),(t.Color||t.Triangles>=10)&&(t.Zscale=s.check("Z")),t.isAny=function(){return this.Markers||this.Error||this.Circles||this.Line||this.Triangles},t.isAny()?(t.Axis="lego2",t.Zscale&&(t.Axis+="z")):t.Axis=i,this.storeDrawOpt(i)}createHistogram(){const i=this.getObject(),h=this.matchObjectType(Z.clTGraph2DAsymmErrors);let s=i.fX[0],t=s,l=i.fY[0],r=l,o=i.fZ[0],n=o;for(let m=0;m<i.fNpoints;++m){const _=i.fX[m],p=i.fY[m],P=i.fZ[m];this.options.Error?(s=Math.min(s,_-(h?i.fEXlow[m]:i.fEX[m])),t=Math.max(t,_+(h?i.fEXhigh[m]:i.fEX[m])),l=Math.min(l,p-(h?i.fEYlow[m]:i.fEY[m])),r=Math.max(r,p+(h?i.fEYhigh[m]:i.fEY[m])),o=Math.min(o,P-(h?i.fEZlow[m]:i.fEZ[m])),n=Math.max(n,P+(h?i.fEZhigh[m]:i.fEZ[m]))):(s=Math.min(s,_),t=Math.max(t,_),l=Math.min(l,p),r=Math.max(r,p),o=Math.min(o,P),n=Math.max(n,P))}function M(m,_,p){return m<_?p*(_-m):Math.abs(m)<1e5?.02:.02*Math.abs(m)}const X=M(s,t,i.fMargin),Y=M(l,r,i.fMargin),N=M(o,n,0);let e=s-X,a=t+X,c=l-Y,f=r+Y,d=o-N,T=n+N;e<0&&s>=0&&(e=.98*s),a>0&&t<=0&&(a=0),c<0&&l>=0&&(c=.98*l),f>0&&r<=0&&(f=0),d<0&&o>=0&&(d=.98*o),T>0&&n<=0&&(T=0);const y=this.getObject();y.fMinimum!==Z.kNoZoom&&(d=y.fMinimum),y.fMaximum!==Z.kNoZoom&&(T=y.fMaximum),this._own_histogram=!0;const u=(0,Z.createHistogram)(Z.clTH2F,y.fNpx,y.fNpy);if(u.fName=y.fName+"_h",(0,Z.setHistogramTitle)(u,y.fTitle),u.fXaxis.fXmin=e,u.fXaxis.fXmax=a,u.fYaxis.fXmin=c,u.fYaxis.fXmax=f,u.fZaxis.fXmin=d,u.fZaxis.fXmax=T,u.fMinimum=d,u.fMaximum=T,u.fBits|=Z.kNoStats,!this.options.isAny()){const m=this.buildDelaunay(y);if(m)for(let _=0;_<y.fNpx;++_){const p=e+(_+.5)/y.fNpx*(a-e);for(let P=0;P<y.fNpy;++P){const E=m.ComputeZ(p,c+(P+.5)/y.fNpy*(f-c));u.fArray[u.getBin(_+1,P+1)]=E}}}return u}buildDelaunay(i){return this._delaunay||(this._delaunay=new Yt(i),this._delaunay.FindAllTriangles(),this._delaunay.fNdt||delete this._delaunay),this._delaunay}drawTriangles(i,h,s,t){const l=this.buildDelaunay(h);if(!l)return;const r=i.logz?Y=>Y<i.scale_zmin?-.1:i.grz(Y):i.grz,o=2===this.options.Triangles,n=this.options.Triangles>=10||o,M=this.options.Triangles%10==1||o&&h.fLineColor!==h.fFillColor,X=new ut.N7(s,r,0,2*i.size_z3d,M);for(X.loop=0;X.loop<2;++X.loop){X.createBuffers();for(let Y=0;Y<l.fNdt;++Y){const N=[l.fPTried[Y],l.fNTried[Y],l.fMTried[Y]],e=[];let a=!0;for(let c=0;c<3;++c){const f=N[c]-1;e.push(i.grx(h.fX[f]),i.gry(h.fY[f]),r(h.fZ[f])),(h.fX[f]<i.scale_xmin||h.fX[f]>i.scale_xmax||h.fY[f]<i.scale_ymin||h.fY[f]>i.scale_ymax)&&(a=!1)}n&&a&&X.addMainTriangle(...e),M&&a&&(X.addLineSegment(e[0],e[1],e[2],e[3],e[4],e[5]),X.addLineSegment(e[3],e[4],e[5],e[6],e[7],e[8]),X.addLineSegment(e[6],e[7],e[8],e[0],e[1],e[2]))}}X.callFuncs((Y,N)=>{const e=(0,V.cD)(this.getMainPainter(),N,null,100,100),a=o?this.getColor(h.fFillColor):t.calcColor(Y,s.length),c=new C.ZH.MeshBasicMaterial((0,C.Bx)(a,{side:C.ZH.DoubleSide,vertexColors:!1})),f=new C.ZH.Mesh(e,c);i.add3DMesh(f,this),f.painter=this},(Y,N)=>{const e=this.getColor(h.fLineColor),a=new C.ZH.LineBasicMaterial({color:new C.ZH.Color(e),linewidth:h.fLineWidth}),c=(0,C.Fc)((0,V.QK)(this.getMainPainter(),N,100,100),a);i.add3DMesh(c,this)})}updateObject(i,h){if(!this.matchObjectType(i))return!1;if(h&&h!==this.options.original&&this.decodeOptions(h,i),Object.assign(this.getObject(),i),delete this._delaunay,delete this.$redraw_hist,this.axes_draw){const s=this.getMainPainter();s?.updateObject(this.createHistogram(),this.options.Axis),this.$redraw_hist=s}return!0}redraw(){var i=this;return(0,R.A)(function*(){let h=Promise.resolve(!0);return i.$redraw_hist&&(h=i.$redraw_hist.redraw(),delete i.$redraw_hist),h.then(()=>i.drawGraph2D())})()}drawGraph2D(){var i=this;return(0,R.A)(function*(){const h=i.getMainPainter(),s=i.getFramePainter(),t=i.getObject();if(!(t&&h&&s&&s.mode3d))return i;if(s.remove3DMeshes(i),!i.options.isAny()){if(h.draw_content)return i;1===t.fMarkerSize&&1===t.fMarkerStyle?i.options.Circles=!0:i.options.Markers=!0}const l=(N,e)=>{let a=0;for(let c=0;c<t.fNpoints;++c)t.fX[c]<s.scale_xmin||t.fX[c]>s.scale_xmax||t.fY[c]<s.scale_ymin||t.fY[c]>s.scale_ymax||t.fZ[c]<N||t.fZ[c]>=e||++a;return a};let r=1;if(Z.settings.OptimizeDraw>0&&!s.webgl){const N=l(s.scale_zmin,s.scale_zmax),e=5e4;N>e&&(r=Math.floor(N/e),r<=2&&(r=2))}const o=i.createAttMarker({attr:t,std:!1}),n=[];let M=null,X=[s.scale_zmin,s.scale_zmax],Y=s.size_x3d/100*o.getFullSize();i.options.Circles&&(Y=.06*s.size_x3d),s.usesvg&&(Y*=.3),Y*=7*Math.max(s.size_x3d/s.getFrameWidth(),s.size_z3d/s.getFrameHeight()),(i.options.Color||i.options.Triangles>=10)&&(X=h.getContourLevels(!0),M=h.getHistPalette()),i.options.Triangles&&i.drawTriangles(s,t,X,M);for(let N=0;N<X.length-1;++N){const e=Math.max(X[N],s.scale_zmin),a=Math.min(X[N+1],s.scale_zmax);if(e>=a)continue;const c=Math.floor(l(e,a)/r),f=new Int32Array(c);let d=null,T=0,y=0,u=null,m=!1,_=null,p=0,P=0;(i.options.Markers||i.options.Circles)&&(d=new C._l(c,s.webgl,Y/3)),i.options.Error&&(u=new Float32Array(6*c*3),m=i.matchObjectType(Z.clTGraph2DAsymmErrors)),i.options.Line&&(_=new Float32Array(6*(c-1)));for(let x=0;x<t.fNpoints;++x){if(t.fX[x]<s.scale_xmin||t.fX[x]>s.scale_xmax||t.fY[x]<s.scale_ymin||t.fY[x]>s.scale_ymax||t.fZ[x]<e||t.fZ[x]>=a||r>1&&(T=(T+1)%r,0!==T))continue;f[y++]=x;const E=s.grx(t.fX[x]),g=s.gry(t.fY[x]),w=s.grz(t.fZ[x]);d&&d.addPoint(E,g,w),u&&(u[p]=s.grx(t.fX[x]-(m?t.fEXlow[x]:t.fEX[x])),u[p+1]=g,u[p+2]=w,u[p+3]=s.grx(t.fX[x]+(m?t.fEXhigh[x]:t.fEX[x])),u[p+4]=g,u[p+5]=w,p+=6,u[p]=E,u[p+1]=s.gry(t.fY[x]-(m?t.fEYlow[x]:t.fEY[x])),u[p+2]=w,u[p+3]=E,u[p+4]=s.gry(t.fY[x]+(m?t.fEYhigh[x]:t.fEY[x])),u[p+5]=w,p+=6,u[p]=E,u[p+1]=g,u[p+2]=s.grz(t.fZ[x]-(m?t.fEZlow[x]:t.fEZ[x])),u[p+3]=E,u[p+4]=g,u[p+5]=s.grz(t.fZ[x]+(m?t.fEZhigh[x]:t.fEZ[x])),p+=6),_&&(P>=6&&(_[P]=_[P-3],_[P+1]=_[P-2],_[P+2]=_[P-1],P+=3),_[P]=E,_[P+1]=g,_[P+2]=w,P+=3)}if(_&&P>3&&_.length===P){const x=i.getColor(t.fLineColor),E=new C.ZH.LineBasicMaterial({color:new C.ZH.Color(x),linewidth:t.fLineWidth}),g=(0,C.Fc)(_,E);s.add3DMesh(g,i),g.graph=t,g.index=f,g.fp=s,g.scale0=.7*Y,g.tip_name=i.getObjectHint(),g.tip_color=3===t.fMarkerColor?16711680:65280,g.nvertex=2,g.check_next=!0,g.tooltip=W}if(u){const x=i.getColor(t.fLineColor),E=new C.ZH.LineBasicMaterial({color:new C.ZH.Color(x),linewidth:t.fLineWidth}),g=(0,C.Fc)(u,E);s.add3DMesh(g,i),g.graph=t,g.index=f,g.fp=s,g.scale0=.7*Y,g.tip_name=i.getObjectHint(),g.tip_color=3===t.fMarkerColor?16711680:65280,g.nvertex=6,g.tooltip=W}if(d){let x="blue";(!i.options.Circles||i.options.Color)&&(x=M?.calcColor(N,X.length)??i.getColor(t.fMarkerColor));const E=d.createPoints({color:x,style:i.options.Circles?4:t.fMarkerStyle}).then(g=>{g.graph=t,g.fp=s,g.tip_color=3===t.fMarkerColor?16711680:65280,g.scale0=.3*Y,g.index=f,g.tip_name=i.getObjectHint(),g.tooltip=W,s.add3DMesh(g,i)});n.push(E)}}return Promise.all(n).then(()=>{const N=i.getMainPainter();if(!i.axes_draw&&!1!==N?.draw_content)return;const a=N?.findFunction(Z.clTPaletteAxis),c=i.getPadPainter()?.findPainterFor(a);if(c){if(c.Enabled=i.options.Zscale,i.options.Zscale)return c.drawPave();c.removeG()}}).then(()=>(s.render3D(100),i))})()}static draw(i,h,s){return(0,R.A)(function*(){const t=new $(i,h);t.decodeOptions(s,h);let l=Promise.resolve(null);return t.getMainPainter()||(l=dt.TH2Painter.draw(i,t.createHistogram(),t.options.Axis),t.axes_draw=!0),l.then(()=>(t.addToPadPrimitives(),t.drawGraph2D()))})()}}}}]);