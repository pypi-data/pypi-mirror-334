<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.5">
<title>deepsport_utilities.ds.instants_dataset.views_dataset API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>deepsport_utilities.ds.instants_dataset.views_dataset</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.find_court_intersection_with_camera_border"><code class="name flex">
<span>def <span class="ident">find_court_intersection_with_camera_border</span></span>(<span>calib, court)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def find_court_intersection_with_camera_border(calib, court):
    def dichotomy(inside, outside, max_it=10):
        middle = Point3D((inside+outside)/2)
        if max_it == 0:
            return middle
        max_it = max_it - 1
        return dichotomy(middle, outside, max_it) if calib.projects_in(middle) else dichotomy(inside, middle, max_it)
    def find_point_inside(p1, p2, max_it=5):
        assert not calib.projects_in(p1) and not calib.projects_in(p2)
        middle = Point3D((p1+p2)/2)
        if calib.projects_in(middle):
            return middle
        if max_it == 0:
            return None
        point_inside = find_point_inside(middle, p2, max_it-1)
        if point_inside is not None:
            return point_inside
        return find_point_inside(middle, p1, max_it-1)

    points_inside = list()
    court_keypoints = get_court_keypoints(court)

    for p1, p2 in zip(court_keypoints, court_keypoints[1:] + [court_keypoints[0]]):
        if calib.projects_in(p1) and calib.projects_in(p2):
            points_inside.append(p1)
            points_inside.append(p2)
        elif calib.projects_in(p1):
            points_inside.append(p1)
            points_inside.append(dichotomy(p1, p2))
        elif calib.projects_in(p2):
            points_inside.append(p2)
            points_inside.append(dichotomy(p2, p1))
        else:
            point_inside = find_point_inside(p1, p2)
            if point_inside is not None:
                points_inside.append(dichotomy(point_inside, p2))
                points_inside.append(dichotomy(point_inside, p1))

    return points_inside</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.get_court_keypoints"><code class="name flex">
<span>def <span class="ident">get_court_keypoints</span></span>(<span>court)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_court_keypoints(court):
    return [Point3D(0,0,0), Point3D(court.w,0,0), Point3D(0,court.h,0), Point3D(court.w,court.h,0)]</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViews"><code class="flex name class">
<span>class <span class="ident">BuildBallViews</span></span>
<span>(</span><span>margin, *args, origins=['annotation'], **kwargs)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class BuildBallViews(ViewBuilder):
    def __init__(self, margin, *args, origins=[&#34;annotation&#34;], **kwargs):
        super().__init__(margin, *args, **kwargs)
        self.origins = origins
    def __call__(self, instant_key: InstantKey, instant: Instant):
        balls = [a for a in instant.annotations + getattr(instant, &#34;detections&#34;, []) if a.type == &#39;ball&#39;]
        # &#39;ballseg.*&#39; matches &#39;ballseg&#39; and &#39;ballseg+ballsize&#39;
        predicate = lambda a: any(re.fullmatch(origin, a.origin) for origin in self.origins)
        for idx, ball in enumerate(filter(predicate, balls)):
            if not instant.calibs[ball.camera].projects_in(ball.center):
                continue
            keypoints = [ball.center]
            c = int(ball.camera)
            timestamp = getattr(instant, &#34;timestamps&#34;, [instant.timestamp]*instant.num_cameras)[c] # timestamps may be different for each camera
            yield ViewDescription(c, idx, self.compute_box(keypoints, instant.calibs[c]), ball=ball, timestamp=timestamp)</code></pre>
</details>
<div class="desc"><p>Margin given in world coordinates by default, except if <code>margin_in_pixels</code> is True.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder">ViewBuilder</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViewsWithRandom" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViewsWithRandom">BuildBallViewsWithRandom</a></li>
</ul>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViewsWithRandom"><code class="flex name class">
<span>class <span class="ident">BuildBallViewsWithRandom</span></span>
<span>(</span><span>*args, random: float = 0, **kwargs)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class BuildBallViewsWithRandom(BuildBallViews):
    &#34;&#34;&#34; random: a proportion of random views that are at least `margin` away from any created view.
    &#34;&#34;&#34;
    def __init__(self, *args, random: float=0, **kwargs):
        assert 0 &lt;= random &lt; 1, &#34;random must be in [0,1[&#34;
        super().__init__(*args, **kwargs)
        self.random = random
        self.record = {True: 0, False: 0}
    def compute_box(self, point3D_list: list, calib: Calib):
        if self.margin == np.inf:
            return BoundingBox(0, 0, calib.width, calib.height)
        return super().compute_box(point3D_list, calib)
    def __call__(self, instant_key: InstantKey, instant: Instant):
        idx = 0
        boxes = {}
        for view_description in super().__call__(instant_key, instant):
            yield view_description
            idx = view_description.index + 1
            boxes.setdefault(view_description.camera, []).append(view_description.box)
            self.record[True] += 1

        court = instant.court
        while (self.record[False] + 1)/(sum(self.record.values())+1) &lt; self.random:
            camera = np.random.randint(instant.num_cameras)

            top_edge = list(court.visible_edges(instant.calibs[camera]))[0]
            start = top_edge[0][0][0]
            stop = top_edge[1][0][0]
            x = np.random.beta(2, 2)*(stop-start)+start
            y = np.random.beta(2, 2)*court.h/2+court.h/4
            z = np.random.randint(-400, 0)
            point3D = Point3D(x,y,z)
            if not instant.calibs[camera].projects_in(point3D):
                continue

            point2D = instant.calibs[camera].project_3D_to_2D(point3D)
            if any([box.x &lt;= point2D.x &lt;= box.x+box.w and box.y &lt;= point2D.y &lt;= box.y+box.h for box in boxes.get(camera, [])]):
                continue

            ball = Ball({
                &#39;origin&#39;: &#39;random&#39;,
                &#39;center&#39;: point3D,
                &#39;image&#39;: camera,
                &#39;visible&#39;: False,
                &#39;status&#39;: BallState.NONE,
                &#39;value&#39;: 0
            })
            keypoints = [point3D]
            c = int(ball.camera)
            timestamp = getattr(instant, &#34;timestamps&#34;, [instant.timestamp]*instant.num_cameras)[c] # timestamps may be different for each camera
            yield ViewDescription(c, idx, self.compute_box(keypoints, instant.calibs[c]), ball=ball, timestamp=timestamp)
            idx += 1
            self.record[False] += 1</code></pre>
</details>
<div class="desc"><p>random: a proportion of random views that are at least <code>margin</code> away from any created view.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViews">BuildBallViews</a></li>
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder">ViewBuilder</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViewsWithRandom.compute_box"><code class="name flex">
<span>def <span class="ident">compute_box</span></span>(<span>self,<br>point3D_list: list,<br>calib: <a title="deepsport_utilities.calib.Calib" href="../../calib.html#deepsport_utilities.calib.Calib">Calib</a>)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def compute_box(self, point3D_list: list, calib: Calib):
    if self.margin == np.inf:
        return BoundingBox(0, 0, calib.width, calib.height)
    return super().compute_box(point3D_list, calib)</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildCameraViews"><code class="flex name class">
<span>class <span class="ident">BuildCameraViews</span></span>
<span>(</span><span>margin: float = 0, padding: int = None, margin_in_pixels: bool = False)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class BuildCameraViews(ViewBuilder):
    &#34;&#34;&#34; Builds a view for each camera (margin parameter is useless)
    &#34;&#34;&#34;
    def __call__(self, instant_key: InstantKey, instant:Instant):
        for c in range(instant.num_cameras):
            yield ViewDescription(c, 0, BoundingBox(0, 0, instant.calibs[c].width, instant.calibs[c].height))</code></pre>
</details>
<div class="desc"><p>Builds a view for each camera (margin parameter is useless)</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder">ViewBuilder</a></li>
</ul>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildCourtViews"><code class="flex name class">
<span>class <span class="ident">BuildCourtViews</span></span>
<span>(</span><span>margin: float = 0,<br>padding: int = None,<br>margin_in_pixels: bool = False,<br>height: float = 300)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class BuildCourtViews(ViewBuilder):
    &#34;&#34;&#34; Builds a view including all the court keypoints visible on each camera
        Note: keypoints are duplicated at 2m from the floor
    &#34;&#34;&#34;
    height: float = 300
    def __call__(self, instant_key: InstantKey, instant:Instant):
        for c in range(instant.num_cameras):
            calib = instant.calibs[c]
            visible_edges = Court(instant.rule_type).visible_edges(calib)
            court_keypoints = []
            for p1, p2 in visible_edges:
                court_keypoints = court_keypoints + [p1, p1+Point3D(0,0,-self.height), p2, p2+Point3D(0,0,-self.height)]
            yield ViewDescription(c, 0, self.compute_box(court_keypoints, calib))</code></pre>
</details>
<div class="desc"><p>Builds a view including all the court keypoints visible on each camera
Note: keypoints are duplicated at 2m from the floor</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder">ViewBuilder</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildCourtViews.height"><code class="name">var <span class="ident">height</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildHeadsViews"><code class="flex name class">
<span>class <span class="ident">BuildHeadsViews</span></span>
<span>(</span><span>margin: float = 0, padding: int = None, margin_in_pixels: bool = False)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class BuildHeadsViews(ViewBuilder):
    def __call__(self, instant_key: InstantKey, instant: Instant):
        for idx, player in enumerate([a for a in instant.annotations if a.type == &#34;player&#34;]):
            c = int(player.camera)
            keypoints = [player.head]
            yield ViewDescription(c, idx, self.compute_box(keypoints, instant.calibs[c]), annotation=player)</code></pre>
</details>
<div class="desc"><p>Margin given in world coordinates by default, except if <code>margin_in_pixels</code> is True.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder">ViewBuilder</a></li>
</ul>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildPlayersViews"><code class="flex name class">
<span>class <span class="ident">BuildPlayersViews</span></span>
<span>(</span><span>margin: float = 0,<br>padding: int = None,<br>margin_in_pixels: bool = False,<br>min_annotations: int = 1)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class BuildPlayersViews(ViewBuilder):
    &#34;&#34;&#34; Builds a view around the players visible on each camera
        min_annotations: minimum required number of person to use that camera
    &#34;&#34;&#34;
    min_annotations: int = 1
    def __call__(self, instant_key: InstantKey, instant: Instant):
        for c in range(instant.num_cameras):
            annotations = [a for a in instant.annotations if a.camera == c and a.type == &#34;player&#34; and a.team &gt; 0]
            if len(annotations) &lt; self.min_annotations:
                continue

            keypoints = []
            for a in annotations:
                keypoints += [a.head, a.hips, a.foot1, a.foot2]

            yield ViewDescription(c, 0, self.compute_box(keypoints, instant.calibs[c]))</code></pre>
</details>
<div class="desc"><p>Builds a view around the players visible on each camera
min_annotations: minimum required number of person to use that camera</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder">ViewBuilder</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildPlayersViews.min_annotations"><code class="name">var <span class="ident">min_annotations</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews"><code class="flex name class">
<span>class <span class="ident">BuildThumbnailViews</span></span>
<span>(</span><span>margin: float = 0,<br>padding: int = None,<br>margin_in_pixels: bool = False,<br>with_annotations: bool = True,<br>with_detections: bool = False,<br>with_random: Tuple[int, bool] = 0,<br>with_occlusions: bool = False)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class BuildThumbnailViews(ViewBuilder):
    &#34;&#34;&#34; Builds a view around each person (players, referee)
    &#34;&#34;&#34;
    with_annotations: bool = True
    with_detections: bool = False
    with_random: Tuple[int, bool] = 0
    with_occlusions: bool = False
    BODY_HEIGHT = 180
    threshold = 0.25
    def __post_init__(self):
        super().__post_init__()
        self.with_random = 10 if isinstance(self.with_random, bool) and self.with_random else self.with_random

    def check_density_map(self, density_map, box, threshold):
        if 0 in density_map[box.y_slice, box.x_slice].shape:
            return False
        if np.mean(density_map[box.y_slice, box.x_slice]) &lt;= threshold:
            return True
        return False

    def sample_density_map(self, density_map):
        # avoid going too close to other detections
        dilation = cv2.dilate(density_map, np.ones((3,3)), iterations=10)
        indices_y, indices_x = np.where(dilation == 0)
        # random choic a position in the image
        i = np.random.randint(0, len(indices_x))
        return np.array([[indices_x[i], indices_y[i]]])

    @staticmethod
    def fill_density_map(density_map, box):
        density_map[box.y_slice, box.x_slice] += 1

    def __call__(self, instant_key: InstantKey, instant:Instant):
        # Set random seed with timestamp
        random_state = np.random.get_state()
        np.random.seed(instant_key.timestamp &amp; 0xFFFFFFFF)

        instant.density_maps = [np.zeros(img.shape[0:2], dtype=np.uint8) for img in instant.images]

        for c in range(instant.num_cameras):
            calib = instant.calibs[c]
            density_map = instant.density_maps[c]
            index = 0

            # From annotation
            for a in [a for a in instant.annotations if a.type == &#34;player&#34; and calib.projects_in(a.hips) and self.with_annotations]:
                keypoints = [a.head, a.hips, a.foot1, a.foot2]
                box = self.compute_box(keypoints, calib)
                #if self.check_density_map(instant.density_maps, box, c, 1+self.threshold) or self.with_occlusions:
                yield ViewDescription(c, index, box, origin=&#39;annotation&#39;, annotation=a, density_map=density_map)
                self.fill_density_map(density_map, box)
                index = index + 1

            if self.with_detections:
                # From keemotion foregrounddetector detections
                # FIXME:
                for detection in []:#[d for d in instant.fg_detections if d.camera == c and calib.projects_in(d.feet) and self.with_detections]:
                    keypoints = [ detection.feet, detection.feet + Point3D(0, 0, -self.BODY_HEIGHT) ]
                    box = self.compute_box(keypoints, calib)
                    if self.check_density_map(density_map, box, self.threshold):
                        yield ViewDescription(c, index, box, origin=&#39;detection&#39;, detection=detection, density_map=density_map)
                        self.fill_density_map(density_map, box)
                        index = index + 1


            # From random
            if self.with_random:
                raise NotImplementedError
                # TODO: use Calib.visible_edge() to replace the function &#34;find_court_intersection_with_camera_border&#34;
                court_keypoints_3D = []# find_court_intersection_with_camera_border(calib, instant.court)
                court_keypoints_2D = np.array([calib.project_3D_to_2D(p).to_list() for p in court_keypoints_3D])
                convex_hull = ConvexHull(court_keypoints_2D)
                points = np.array([court_keypoints_2D[i,:] for i in convex_hull.vertices]).astype(np.int32)
                court = np.ones(instant.images[c].shape[0:2], dtype=np.uint8)
                density_map[cv2.fillPoly(court, [points], 0)==1] += 1

            for _ in range(self.with_random):
                feet = calib.project_2D_to_3D(Point2D(self.sample_density_map(density_map)), Z=0)
                keypoints = [feet, feet + Point3D(0, 0, -self.BODY_HEIGHT)]
                box = self.compute_box(keypoints, calib)
                if self.check_density_map(density_map, box, self.threshold):
                    yield ViewDescription(c, index, box, origin=&#39;random&#39;, density_map=density_map)
                    self.fill_density_map(density_map, box)
                    index = index + 1

        # Restore random seed
        np.random.set_state(random_state)</code></pre>
</details>
<div class="desc"><p>Builds a view around each person (players, referee)</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder">ViewBuilder</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.BODY_HEIGHT"><code class="name">var <span class="ident">BODY_HEIGHT</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.threshold"><code class="name">var <span class="ident">threshold</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_annotations"><code class="name">var <span class="ident">with_annotations</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_detections"><code class="name">var <span class="ident">with_detections</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_occlusions"><code class="name">var <span class="ident">with_occlusions</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_random"><code class="name">var <span class="ident">with_random</span> : Tuple[int, bool]</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Static methods</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.fill_density_map"><code class="name flex">
<span>def <span class="ident">fill_density_map</span></span>(<span>density_map, box)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def fill_density_map(density_map, box):
    density_map[box.y_slice, box.x_slice] += 1</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.check_density_map"><code class="name flex">
<span>def <span class="ident">check_density_map</span></span>(<span>self, density_map, box, threshold)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_density_map(self, density_map, box, threshold):
    if 0 in density_map[box.y_slice, box.x_slice].shape:
        return False
    if np.mean(density_map[box.y_slice, box.x_slice]) &lt;= threshold:
        return True
    return False</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.sample_density_map"><code class="name flex">
<span>def <span class="ident">sample_density_map</span></span>(<span>self, density_map)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sample_density_map(self, density_map):
    # avoid going too close to other detections
    dilation = cv2.dilate(density_map, np.ones((3,3)), iterations=10)
    indices_y, indices_x = np.where(dilation == 0)
    # random choic a position in the image
    i = np.random.randint(0, len(indices_x))
    return np.array([[indices_x[i], indices_y[i]]])</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.View"><code class="flex name class">
<span>class <span class="ident">View</span></span>
<span>(</span><span>all_images, calib, annotations=None, **kwargs)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class View():
    def __init__(self, all_images, calib, annotations=None, **kwargs):
        self.image = all_images[0]
        self.all_images = all_images
        self.calib = calib
        self.annotations = annotations
        for k, v in kwargs.items():
            setattr(self, k, v)

    def draw(self):
        image = self.image.copy()

        coord_2D_int = lambda x: self.calib.project_3D_to_2D(x).to_int_tuple()

        for annotation in self.annotations:
            if annotation.type == &#34;player&#34;:
                head = annotation.head
                hips = annotation.hips
                foot1 = annotation.foot1
                foot2 = annotation.foot2

                color = [0, 0, 0]
                color[annotation.team-1] = 255
                cv2.line(image, coord_2D_int(head), coord_2D_int(hips), color, 3)
                cv2.line(image, coord_2D_int(hips), coord_2D_int(foot1), color, 3)
                cv2.line(image, coord_2D_int(hips), coord_2D_int(foot2), color, 3)

            elif annotation.type == &#34;ball&#34;:
                ball =  annotation.center
                color = [255, 255, 0]
                cv2.circle(image, coord_2D_int(ball), 5, color, -1)

        return image</code></pre>
</details>
<div class="desc"></div>
<h3>Methods</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.View.draw"><code class="name flex">
<span>def <span class="ident">draw</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def draw(self):
    image = self.image.copy()

    coord_2D_int = lambda x: self.calib.project_3D_to_2D(x).to_int_tuple()

    for annotation in self.annotations:
        if annotation.type == &#34;player&#34;:
            head = annotation.head
            hips = annotation.hips
            foot1 = annotation.foot1
            foot2 = annotation.foot2

            color = [0, 0, 0]
            color[annotation.team-1] = 255
            cv2.line(image, coord_2D_int(head), coord_2D_int(hips), color, 3)
            cv2.line(image, coord_2D_int(hips), coord_2D_int(foot1), color, 3)
            cv2.line(image, coord_2D_int(hips), coord_2D_int(foot2), color, 3)

        elif annotation.type == &#34;ball&#34;:
            ball =  annotation.center
            color = [255, 255, 0]
            cv2.circle(image, coord_2D_int(ball), 5, color, -1)

    return image</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder"><code class="flex name class">
<span>class <span class="ident">ViewBuilder</span></span>
<span>(</span><span>margin: float = 0, padding: int = None, margin_in_pixels: bool = False)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class ViewBuilder():
    &#34;&#34;&#34; Margin given in world coordinates by default, except if `margin_in_pixels` is True.
    &#34;&#34;&#34;
    margin: float = 0
    padding: int = None
    margin_in_pixels: bool = False
    def __post_init__(self):
        if self.margin_in_pixels:
            self.padding = self.margin if self.padding is None else self.padding
            self.compute_margin = lambda calib, p3d: self.margin
        else:
            self.padding = self.padding or 0
            self.compute_margin = lambda calib, p3d: calib.compute_length2D(p3d, self.margin)

    def compute_box(self, point3D_list: list, calib: Calib):
        point_and_margin_2D = [(
                calib.project_3D_to_2D(point3D),
                self.compute_margin(calib, point3D)
            ) for point3D in point3D_list]
        left_idx  = np.argmin([d[0].x for d in point_and_margin_2D])
        right_idx = np.argmax([d[0].x for d in point_and_margin_2D])
        top_idx   = np.argmin([d[0].y for d in point_and_margin_2D])
        bot_idx   = np.argmax([d[0].y for d in point_and_margin_2D])

        left  = max(-self.padding,             point_and_margin_2D[left_idx][0].x - point_and_margin_2D[left_idx][1])
        right = min(calib.width+self.padding,  point_and_margin_2D[right_idx][0].x + point_and_margin_2D[right_idx][1])
        top   = max(-self.padding,             point_and_margin_2D[top_idx][0].y - point_and_margin_2D[top_idx][1])
        bot   = min(calib.height+self.padding, point_and_margin_2D[bot_idx][0].y + point_and_margin_2D[bot_idx][1])

        return BoundingBox(round(left), round(top), round(right-left), round(bot-top))</code></pre>
</details>
<div class="desc"><p>Margin given in world coordinates by default, except if <code>margin_in_pixels</code> is True.</p></div>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViews">BuildBallViews</a></li>
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildCameraViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildCameraViews">BuildCameraViews</a></li>
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildCourtViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildCourtViews">BuildCourtViews</a></li>
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildHeadsViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildHeadsViews">BuildHeadsViews</a></li>
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildPlayersViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildPlayersViews">BuildPlayersViews</a></li>
<li><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews">BuildThumbnailViews</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.margin"><code class="name">var <span class="ident">margin</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.margin_in_pixels"><code class="name">var <span class="ident">margin_in_pixels</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.padding"><code class="name">var <span class="ident">padding</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.compute_box"><code class="name flex">
<span>def <span class="ident">compute_box</span></span>(<span>self,<br>point3D_list: list,<br>calib: <a title="deepsport_utilities.calib.Calib" href="../../calib.html#deepsport_utilities.calib.Calib">Calib</a>)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def compute_box(self, point3D_list: list, calib: Calib):
    point_and_margin_2D = [(
            calib.project_3D_to_2D(point3D),
            self.compute_margin(calib, point3D)
        ) for point3D in point3D_list]
    left_idx  = np.argmin([d[0].x for d in point_and_margin_2D])
    right_idx = np.argmax([d[0].x for d in point_and_margin_2D])
    top_idx   = np.argmin([d[0].y for d in point_and_margin_2D])
    bot_idx   = np.argmax([d[0].y for d in point_and_margin_2D])

    left  = max(-self.padding,             point_and_margin_2D[left_idx][0].x - point_and_margin_2D[left_idx][1])
    right = min(calib.width+self.padding,  point_and_margin_2D[right_idx][0].x + point_and_margin_2D[right_idx][1])
    top   = max(-self.padding,             point_and_margin_2D[top_idx][0].y - point_and_margin_2D[top_idx][1])
    bot   = min(calib.height+self.padding, point_and_margin_2D[bot_idx][0].y + point_and_margin_2D[bot_idx][1])

    return BoundingBox(round(left), round(top), round(right-left), round(bot-top))</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewDescription"><code class="flex name class">
<span>class <span class="ident">ViewDescription</span></span>
<span>(</span><span>camera,<br>index,<br>box: <a title="deepsport_utilities.utils.BoundingBox" href="../../utils.html#deepsport_utilities.utils.BoundingBox">BoundingBox</a>,<br>**kwargs)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ViewDescription():
    def __init__(self, camera, index, box: BoundingBox, **kwargs):
        self.camera = camera
        self.index = index
        self.box = box
        self.data = kwargs</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey"><code class="flex name class">
<span>class <span class="ident">ViewKey</span></span>
<span>(</span><span>instant_key: <a title="deepsport_utilities.ds.instants_dataset.instants_dataset.InstantKey" href="instants_dataset.html#deepsport_utilities.ds.instants_dataset.instants_dataset.InstantKey">InstantKey</a>,<br>camera: int,<br>index: int)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ViewKey(NamedTuple):
    instant_key: InstantKey
    camera: int
    index: int

    @property
    def arena_label(self):
        return self.instant_key.arena_label

    @property
    def timestamp(self):
        return self.instant_key.timestamp

    @property
    def game_id(self):
        return self.instant_key.game_id</code></pre>
</details>
<div class="desc"><p>ViewKey(instant_key, camera, index)</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.arena_label"><code class="name">prop <span class="ident">arena_label</span></code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def arena_label(self):
    return self.instant_key.arena_label</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.camera"><code class="name">var <span class="ident">camera</span> : int</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ViewKey(NamedTuple):
    instant_key: InstantKey
    camera: int
    index: int

    @property
    def arena_label(self):
        return self.instant_key.arena_label

    @property
    def timestamp(self):
        return self.instant_key.timestamp

    @property
    def game_id(self):
        return self.instant_key.game_id</code></pre>
</details>
<div class="desc"><p>Alias for field number 1</p></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.game_id"><code class="name">prop <span class="ident">game_id</span></code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def game_id(self):
    return self.instant_key.game_id</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.index"><code class="name">var <span class="ident">index</span> : int</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ViewKey(NamedTuple):
    instant_key: InstantKey
    camera: int
    index: int

    @property
    def arena_label(self):
        return self.instant_key.arena_label

    @property
    def timestamp(self):
        return self.instant_key.timestamp

    @property
    def game_id(self):
        return self.instant_key.game_id</code></pre>
</details>
<div class="desc"><p>Alias for field number 2</p></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.instant_key"><code class="name">var <span class="ident">instant_key</span> : <a title="deepsport_utilities.ds.instants_dataset.instants_dataset.InstantKey" href="instants_dataset.html#deepsport_utilities.ds.instants_dataset.instants_dataset.InstantKey">InstantKey</a></code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ViewKey(NamedTuple):
    instant_key: InstantKey
    camera: int
    index: int

    @property
    def arena_label(self):
        return self.instant_key.arena_label

    @property
    def timestamp(self):
        return self.instant_key.timestamp

    @property
    def game_id(self):
        return self.instant_key.game_id</code></pre>
</details>
<div class="desc"><p>Alias for field number 0</p></div>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.timestamp"><code class="name">prop <span class="ident">timestamp</span></code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def timestamp(self):
    return self.instant_key.timestamp</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewsDataset"><code class="flex name class">
<span>class <span class="ident">ViewsDataset</span></span>
<span>(</span><span>instants_dataset: <a title="deepsport_utilities.ds.instants_dataset.instants_dataset.InstantsDataset" href="instants_dataset.html#deepsport_utilities.ds.instants_dataset.instants_dataset.InstantsDataset">InstantsDataset</a>,<br>view_builder: <a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder">ViewBuilder</a>,<br>output_shape=None,<br>rescale=True,<br>crop=True,<br>debug=False)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ViewsDataset(AugmentedDataset):
    &#34;&#34;&#34; Dataset of views built according the given ViewBuilder, extracted from the given InstantDataset.
        Arguments:
            instants_dataset   - the InstantDataset from which views are built
            view_builder       - the ViewBuilder dictating what type of view is to be created
            output_shape       - view aspect ratio (or exact dimension if &#39;rescale&#39; is given)
            rescale            - tells whether the view should be rescaled to output_shape size
            crop               - tells whether the original image should be cropped or a rectangle
                                 should be drawn instead (for debug purposes)
    &#34;&#34;&#34;
    def __init__(self, instants_dataset: InstantsDataset, view_builder: ViewBuilder, output_shape=None, rescale=True, crop=True, debug=False):
        super().__init__(instants_dataset)
        self.view_builder = view_builder
        self.output_shape = output_shape
        self.rescale = rescale
        self.crop = crop
        self.debug = debug

    def _crop_view(self, view_description: ViewDescription, instant: Instant, **kwargs):
        padding = self.view_builder.padding
        c = view_description.camera
        input_height, input_width, _ = instant.images[c].shape
        aspect_ratio = self.output_shape[0]/self.output_shape[1] if self.output_shape else None
        x_slice, y_slice = view_description.box.increase_box(
            max_width=input_width,
            max_height=input_height,
            aspect_ratio=aspect_ratio,
            padding=self.view_builder.padding
        )

        if self.crop:
            all_images = []
            for offset in instant.offsets:
                index = (c,offset)
                if index not in instant.all_images:
                    continue # that offset was not downloaded with the download flag of instants dataset
                image = crop_padded(instant.all_images[index], x_slice, y_slice, padding)
                height, width, _ = image.shape
                if self.rescale and self.output_shape and (width, height) != self.output_shape:
                    image = cv2.resize(image, self.output_shape)
                all_images.append(image)
            calib = instant.calibs[c].crop(x_slice, y_slice) # handles negative `slice.start` positions
            if self.rescale and self.output_shape:
                calib = calib.scale(*self.output_shape)
            if instant.download_flags &amp; DownloadFlags.WITH_HUMAN_SEGMENTATION_MASKS and instant.human_masks:
                human_masks = crop_padded(instant.human_masks[c], x_slice, y_slice, padding)
                if self.rescale and self.output_shape:
                    human_masks = cv2.resize(human_masks, self.output_shape)
            else:
                human_masks = None
        else:
            if self.debug:
                all_images = []
                for offset in instant.offsets:
                    # the coordinates of the rectangle below are probably wrong see documentation of cv2.rectangle
                    raise NotImplementedError(&#34;TODO: check rectangle coordinates&#34;)
                    image = cv2.rectangle(instant.all_images[(c, offset)], (x_slice.start, x_slice.stop), (y_slice.start, y_slice.stop), (255,0,0), 10)
                    all_images.append(image)
            else:
                all_images = instant.all_images
            calib = instant.calibs[c]
            human_masks = instant.human_masks[c]

        return View(all_images, calib, instant.annotations, rule_type=instant.rule_type, human_masks=human_masks, **kwargs)

    def augment(self, instant_key: InstantKey, instant: Instant):
        random_state = np.random.get_state()
        np.random.seed(instant_key.timestamp &amp; 0xFFFFFFFF)

        for view_description in self.view_builder(instant_key, instant):
            view_key = ViewKey(instant_key, view_description.camera, view_description.index)
            yield view_key, self._crop_view(view_description, instant, **view_description.data)

        # required to keep the random seed random
        np.random.set_state(random_state)</code></pre>
</details>
<div class="desc"><p>Dataset of views built according the given ViewBuilder, extracted from the given InstantDataset.</p>
<h2 id="arguments">Arguments</h2>
<p>instants_dataset
- the InstantDataset from which views are built
view_builder
- the ViewBuilder dictating what type of view is to be created
output_shape
- view aspect ratio (or exact dimension if 'rescale' is given)
rescale
- tells whether the view should be rescaled to output_shape size
crop
- tells whether the original image should be cropped or a rectangle
should be drawn instead (for debug purposes)</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>mlworkflow.datasets.AugmentedDataset</li>
<li>mlworkflow.datasets.Dataset</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="deepsport_utilities.ds.instants_dataset.views_dataset.ViewsDataset.augment"><code class="name flex">
<span>def <span class="ident">augment</span></span>(<span>self,<br>instant_key: <a title="deepsport_utilities.ds.instants_dataset.instants_dataset.InstantKey" href="instants_dataset.html#deepsport_utilities.ds.instants_dataset.instants_dataset.InstantKey">InstantKey</a>,<br>instant: <a title="deepsport_utilities.ds.instants_dataset.instants_dataset.Instant" href="instants_dataset.html#deepsport_utilities.ds.instants_dataset.instants_dataset.Instant">Instant</a>)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def augment(self, instant_key: InstantKey, instant: Instant):
    random_state = np.random.get_state()
    np.random.seed(instant_key.timestamp &amp; 0xFFFFFFFF)

    for view_description in self.view_builder(instant_key, instant):
        view_key = ViewKey(instant_key, view_description.camera, view_description.index)
        yield view_key, self._crop_view(view_description, instant, **view_description.data)

    # required to keep the random seed random
    np.random.set_state(random_state)</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="deepsport_utilities.ds.instants_dataset" href="index.html">deepsport_utilities.ds.instants_dataset</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.find_court_intersection_with_camera_border" href="#deepsport_utilities.ds.instants_dataset.views_dataset.find_court_intersection_with_camera_border">find_court_intersection_with_camera_border</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.get_court_keypoints" href="#deepsport_utilities.ds.instants_dataset.views_dataset.get_court_keypoints">get_court_keypoints</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViews">BuildBallViews</a></code></h4>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViewsWithRandom" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViewsWithRandom">BuildBallViewsWithRandom</a></code></h4>
<ul class="">
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViewsWithRandom.compute_box" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildBallViewsWithRandom.compute_box">compute_box</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildCameraViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildCameraViews">BuildCameraViews</a></code></h4>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildCourtViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildCourtViews">BuildCourtViews</a></code></h4>
<ul class="">
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildCourtViews.height" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildCourtViews.height">height</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildHeadsViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildHeadsViews">BuildHeadsViews</a></code></h4>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildPlayersViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildPlayersViews">BuildPlayersViews</a></code></h4>
<ul class="">
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildPlayersViews.min_annotations" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildPlayersViews.min_annotations">min_annotations</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews">BuildThumbnailViews</a></code></h4>
<ul class="two-column">
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.BODY_HEIGHT" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.BODY_HEIGHT">BODY_HEIGHT</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.check_density_map" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.check_density_map">check_density_map</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.fill_density_map" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.fill_density_map">fill_density_map</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.sample_density_map" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.sample_density_map">sample_density_map</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.threshold" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.threshold">threshold</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_annotations" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_annotations">with_annotations</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_detections" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_detections">with_detections</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_occlusions" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_occlusions">with_occlusions</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_random" href="#deepsport_utilities.ds.instants_dataset.views_dataset.BuildThumbnailViews.with_random">with_random</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.View" href="#deepsport_utilities.ds.instants_dataset.views_dataset.View">View</a></code></h4>
<ul class="">
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.View.draw" href="#deepsport_utilities.ds.instants_dataset.views_dataset.View.draw">draw</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder">ViewBuilder</a></code></h4>
<ul class="">
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.compute_box" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.compute_box">compute_box</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.margin" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.margin">margin</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.margin_in_pixels" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.margin_in_pixels">margin_in_pixels</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.padding" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewBuilder.padding">padding</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewDescription" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewDescription">ViewDescription</a></code></h4>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey">ViewKey</a></code></h4>
<ul class="two-column">
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.arena_label" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.arena_label">arena_label</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.camera" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.camera">camera</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.game_id" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.game_id">game_id</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.index" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.index">index</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.instant_key" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.instant_key">instant_key</a></code></li>
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.timestamp" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewKey.timestamp">timestamp</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewsDataset" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewsDataset">ViewsDataset</a></code></h4>
<ul class="">
<li><code><a title="deepsport_utilities.ds.instants_dataset.views_dataset.ViewsDataset.augment" href="#deepsport_utilities.ds.instants_dataset.views_dataset.ViewsDataset.augment">augment</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.5</a>.</p>
</footer>
</body>
</html>
