{"version":3,"file":"lib_index_js.8bd91b37a3bfea950e2b.js","mappings":"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","sources":["webpack://escrowai-jupyter/./src/index.ts"],"sourcesContent":["import { JupyterFrontEnd, JupyterFrontEndPlugin } from '@jupyterlab/application';\nimport { ICommandPalette, showDialog, Dialog } from '@jupyterlab/apputils';\nimport { MainAreaWidget } from '@jupyterlab/apputils';\nimport { Widget } from '@lumino/widgets';\nimport { AnsiUp } from 'ansi_up';\n\nconst ansi_up = new AnsiUp();\n\nclass ProgressWidget extends Widget {\n  private stepLabel: HTMLDivElement;\n  private progressBar: HTMLDivElement;\n  private progressFill: HTMLDivElement;\n  private detailsLabel: HTMLDivElement;\n  private latestByStep: Map<string, string>;\n  private currentStep: string;\n\n  constructor() {\n    super();\n    this.addClass('jp-EscrowAI-progress');\n    \n    // Create the progress container\n    const container = document.createElement('div');\n    container.className = 'escrowai-progress-container';\n    \n    // Create progress elements\n    this.stepLabel = document.createElement('div');\n    this.stepLabel.className = 'escrowai-step-label';\n    \n    this.progressBar = document.createElement('div');\n    this.progressBar.className = 'escrowai-progress-bar';\n    \n    this.progressFill = document.createElement('div');\n    this.progressFill.className = 'escrowai-progress-fill';\n    this.progressBar.appendChild(this.progressFill);\n    \n    // Create a fixed header that contains the step label and progress bar\n    const headerContainer = document.createElement('div');\n    headerContainer.className = 'escrowai-header-container';\n    headerContainer.appendChild(this.stepLabel);\n    headerContainer.appendChild(this.progressBar);\n    \n    this.detailsLabel = document.createElement('div');\n    this.detailsLabel.className = 'escrowai-details-label';\n    \n    // Add elements to container\n    container.appendChild(headerContainer);\n    container.appendChild(this.detailsLabel);\n    \n    this.node.appendChild(container);\n\n    // Initialize state\n    this.currentStep = 'Initializing...';\n    this.latestByStep = new Map<string, string>();\n    \n    // Initialize with starting state\n    this.updateProgress(this.currentStep, 'Preparing to start upload...', 0);\n    console.log('ProgressWidget: Initialization complete');\n  }\n\n  private setErrorState(isError: boolean): void {\n    if (isError) {\n      this.stepLabel.classList.add('error');\n      this.progressFill.classList.add('error');\n    } else {\n      this.stepLabel.classList.remove('error');\n      this.progressFill.classList.remove('error');\n    }\n  }\n\n  private scrollToBottom(): void {\n    // Ensure scrolling to the bottom\n    this.detailsLabel.scrollTop = this.detailsLabel.scrollHeight;\n  }\n\n  updateProgress(step: string, details: string, progress: number): void {\n    console.log('updateProgress:', { step, details, progress });\n    \n    // Check if this is an error state\n    const isError = step === 'Error';\n    this.setErrorState(isError);\n    \n    // Update step if it has changed\n    if (step !== this.currentStep) {\n      console.log('Step changed from', this.currentStep, 'to', step);\n      this.currentStep = step;\n      this.stepLabel.textContent = step;\n    }\n    \n    // Add new details if it's not empty\n    if (details && details.trim()) {\n      // Store only the latest update for this step\n      const timestamp = new Date().toLocaleTimeString();\n      this.latestByStep.set(step, `[${timestamp}] ${details}`);\n      \n      // Update the display\n      this.updateDisplay();\n    }\n    \n    // Update progress bar\n    const progressWidth = `${Math.min(100, Math.max(0, progress))}%`;\n    this.progressFill.style.width = progressWidth;\n    \n    // Scroll to bottom\n    this.scrollToBottom();\n  }\n  \n  private updateDisplay(): void {\n    // Only show the current step's output\n    if (this.latestByStep.has(this.currentStep)) {\n      const content = this.latestByStep.get(this.currentStep)!;\n      const stepContent = `<div class=\"escrowai-output-line\">${ansi_up.ansi_to_html(content)}</div>`;\n      \n      this.detailsLabel.innerHTML = stepContent;\n    } else {\n      this.detailsLabel.innerHTML = '';\n    }\n  }\n}\n\n/**\n * Initialization data for the escrowai-jupyter extension.\n */\nconst plugin: JupyterFrontEndPlugin<void> = {\n  id: 'escrowai-jupyter:plugin',\n  description: 'An extension to encrypt and upload the working directory to EscrowAI',\n  autoStart: true,\n  optional: [ICommandPalette],\n  activate: (app: JupyterFrontEnd, palette: ICommandPalette | null) => {\n    console.log('EscrowAI Extension: Activating...');\n    const command = 'escrowai-jupyter:run-script';\n    \n    app.commands.addCommand(command, {\n      label: 'Upload to EscrowAI',\n      execute: async () => {\n        console.log('EscrowAI Extension: Command executed');\n        \n        // Create and show the progress widget\n        const content = new ProgressWidget();\n        const widget = new MainAreaWidget({ content });\n        widget.id = 'escrowai-progress';\n        widget.title.label = 'EscrowAI Upload Progress';\n        widget.title.closable = true;\n\n        // Add the widget to the main area\n        app.shell.add(widget, 'main');\n        widget.update();\n\n        try {\n          console.log('EscrowAI Extension: Starting EventSource connection...');\n          const eventSource = new EventSource('/escrowai_jupyter/run-script');\n\n          eventSource.onopen = () => {\n            console.log('EscrowAI Extension: EventSource connection opened');\n          };\n\n          eventSource.onmessage = (event) => {\n            console.log('EscrowAI Extension: Received event data:', event.data);\n            const data = JSON.parse(event.data);\n            console.log('EscrowAI Extension: Parsed event data:', data);\n\n            if (data.status === 'running') {\n              console.log('EscrowAI Extension: Processing running status update');\n              content.updateProgress(\n                data.step || 'Processing...',\n                data.details || '',\n                data.progress || 0\n              );\n            } else if (data.status === 'complete') {\n              console.log('EscrowAI Extension: Processing completion');\n              eventSource.close();\n              content.updateProgress('Complete', 'Upload successful!', 100);\n              \n              showDialog({\n                title: 'Upload Complete',\n                body: new Widget({ node: Private.createHTMLNode('Successfully uploaded to EscrowAI!') }),\n                buttons: [Dialog.okButton()]\n              });\n            } else if (data.status === 'error') {\n              console.error('EscrowAI Extension: Processing error:', data.error);\n              eventSource.close();\n              const errorMessage = data.error || 'Upload failed';\n              content.updateProgress('Error', errorMessage, 0);\n              \n              showDialog({\n                title: 'Upload Failed',\n                body: new Widget({ node: Private.createHTMLNode(`Error: ${ansi_up.ansi_to_html(errorMessage)}`) }),\n                buttons: [Dialog.okButton()]\n              });\n            }\n          };\n\n          eventSource.onerror = (error) => {\n            console.error('EscrowAI Extension: EventSource error:', error);\n            eventSource.close();\n            const errorMessage = 'Connection failed';\n            content.updateProgress('Error', errorMessage, 0);\n            \n            showDialog({\n              title: 'Upload Failed',\n              body: new Widget({ node: Private.createHTMLNode(`Error: ${errorMessage}`) }),\n              buttons: [Dialog.okButton()]\n            });\n          };\n\n        } catch (error) {\n          const errorMessage = String(error);\n          content.updateProgress('Error', errorMessage, 0);\n          \n          showDialog({\n            title: 'Upload Failed',\n            body: new Widget({ node: Private.createHTMLNode(`Error: ${ansi_up.ansi_to_html(errorMessage)}`) }),\n            buttons: [Dialog.okButton()]\n          });\n        }\n      }\n    });\n\n    if (palette) {\n      palette.addItem({ command, category: 'Extensions' });\n    }\n    console.log('EscrowAI Extension: Activation complete');\n  }\n};\n\n/**\n * Private utility functions\n */\nnamespace Private {\n  export function createHTMLNode(html: string): HTMLElement {\n    const node = document.createElement('div');\n    node.innerHTML = html;\n    return node;\n  }\n}\n\nexport default plugin;\n"],"names":[],"sourceRoot":""}